<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SumLink: Number Match Puzzle Game - Train Your Brain</title>
    <meta name="description" content="Challenge your mind with SumLink, the addictive number matching puzzle game. Find pairs of numbers that are the same or sum to 10 to clear the board. A perfect game to improve logic and focus!">
    <meta name="keywords" content="number match, puzzle game, brain game, logic puzzle, math game, number puzzle, brain training, number ten, match 10">
    <link rel="canonical" href="https://play.ezygamers.com/">
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;🧠&lt;/text&gt;&lt;/svg&gt;">
    <link rel="alternate" hreflang="x-default" href="https://play.ezygamers.com/">

    <meta property="og:title" content="SumLink: Number Match Puzzle Game">
    <meta property="og:description" content="Challenge your mind with this addictive number matching puzzle. Can you clear the board?">
    <meta property="og:type" content="website">
    <!-- IMPORTANT: You should create a 1200x630px image for social sharing and upload it to this URL -->
    <meta property="og:image" content="https://i.postimg.cc/NFSSsyQH/nimble-mind-social-card.png">
    <meta property="og:url" content="https://play.ezygamers.com/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SumLink: Number Match Puzzle Game">
    <meta name="twitter:description" content="Challenge your mind with this addictive number matching puzzle. Can you clear the board?">
    <!-- IMPORTANT: You should create a 1200x630px image for social sharing and upload it to this URL -->
    <meta name="twitter:image" content="https://i.postimg.cc/NFSSsyQH/nimble-mind-social-card.png">
    <script type="text/javascript" crossorigin="anonymous" async="" src="https://us-assets.i.posthog.com/static/array.js"></script><script src="https://connect.facebook.net/signals/config/776912784952744?v=2.9.233&amp;r=stable&amp;domain=play.ezygamers.com&amp;hme=dcbbef44c997927c5af260dbc0059090127dce285cd316734e66d01ffe06084e&amp;ex_m=88%2C150%2C130%2C19%2C123%2C62%2C42%2C124%2C69%2C61%2C137%2C77%2C13%2C87%2C27%2C118%2C109%2C67%2C70%2C117%2C134%2C96%2C139%2C7%2C3%2C4%2C6%2C5%2C2%2C78%2C86%2C140%2C214%2C162%2C56%2C219%2C216%2C217%2C49%2C177%2C26%2C66%2C223%2C222%2C165%2C29%2C55%2C8%2C58%2C82%2C83%2C84%2C89%2C113%2C28%2C25%2C116%2C112%2C111%2C131%2C68%2C133%2C132%2C44%2C114%2C54%2C106%2C12%2C136%2C39%2C205%2C207%2C172%2C22%2C23%2C24%2C16%2C17%2C38%2C34%2C36%2C35%2C73%2C79%2C81%2C94%2C122%2C125%2C40%2C95%2C20%2C18%2C100%2C63%2C32%2C127%2C126%2C128%2C119%2C21%2C31%2C53%2C93%2C135%2C64%2C15%2C30%2C187%2C158%2C265%2C203%2C148%2C190%2C183%2C91%2C115%2C72%2C104%2C48%2C41%2C102%2C103%2C108%2C52%2C14%2C110%2C101%2C59%2C43%2C97%2C47%2C50%2C46%2C85%2C138%2C0%2C107%2C11%2C105%2C9%2C1%2C51%2C80%2C57%2C129%2C60%2C99%2C76%2C75%2C45%2C120%2C74%2C71%2C65%2C98%2C90%2C37%2C121%2C33%2C92%2C10%2C141" async=""></script><script async="" src="https://connect.facebook.net/en_US/fbevents.js"></script><script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "SumLink: Number Match",
      "applicationCategory": "Game",
      "operatingSystem": "Web browser",
      "description": "An engaging puzzle game where players match numbers that are identical or sum to ten to clear the board and advance through stages.",
      "genre": ["Puzzle", "Strategy"],
      "offers": {
        "@type": "Offer",
        "price": "0"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "reviewCount": "250"
      }
    }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '776912784952744');
      fbq('track', 'PageView');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none" 
           src="https://www.facebook.com/tr?id=776912784952744&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Meta Pixel Code -->

    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L2L29MMHWX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-L2L29MMHWX');
    </script>
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Re Ms Fs Pe Rs Cs capture Ve calculateEventProperties Ds register register_once register_for_session unregister unregister_for_session zs getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Ls As createPersonProfile Ns Is Us opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing is_capturing clear_opt_in_out_capturing Os debug I js getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_BLLJRB5R4OuRU4u72Sagt5LE99ueBMZ1DmrHH8uksJs', {
            api_host: 'https://us.i.posthog.com',
            person_profiles: 'identified_only',
        })
    </script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: #eaf2ff;
        }
        .grid-cell {
            transition: all 0.2s ease-in-out;
            aspect-ratio: 1 / 1;
            border-right: 1px solid #e0e7ff;
            border-bottom: 1px solid #e0e7ff;
            cursor: pointer;
            position: relative;
            font-size: 1.5rem;
        }
        .grid-cell:active {
            transform: scale(0.95);
            background-color: #dbeafe;
        }
        @media (min-width: 640px) {
            .grid-cell {
                font-size: 1.75rem;
            }
        }
        .game-grid-container {
             border-left: 1px solid #e0e7ff;
             border-top: 1px solid #e0e7ff;
        }
        .highlight {
            background-color: #60a5fa !important;
            color: white !important;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        .blurred {
            color: #d1d5db !important;
            background-color: #f9fafb !important;
            cursor: default;
        }
        .cleared {
            background-color: transparent !important;
            color: transparent !important;
            cursor: default;
            border-color: #e5e7eb !important;
        }
        .selected {
            background-color: #3b82f6 !important;
            color: white !important;
        }
        .hint-highlight {
            background-color: #fde047 !important;
            color: #1f2937 !important;
        }
        .tutorial-initial-highlight {
            background-color: #90EE90 !important;
        }
        .control-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), inset 0 -3px 6px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        #hint-btn {
            font-size: 2.5rem;
        }
         @media (min-width: 640px) {
            .control-button {
                width: 80px;
                height: 80px;
            }
        }
        .control-button:active {
            transform: scale(0.95);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2), inset 0 -2px 4px rgba(0,0,0,0.1);
        }
        .control-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .badge {
            position: absolute;
            top: 0px;
            right: 0px;
            min-width: 24px;
            height: 24px;
        }
         @media (min-width: 640px) {
            .badge {
                min-width: 28px;
                height: 28px;
            }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        #main-game-grid-wrapper {
            scrollbar-width: none;
            overflow-y: auto;
            max-height: 55vh;
        }
        #main-game-grid-wrapper::-webkit-scrollbar {
            display: none;
        }
        #effect-canvas, #win-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 40;
        }
        #win-canvas {
            z-index: 51;
        }
        #win-animation .text-white {
            position: relative;
            z-index: 52;
        }
        .lang-btn.selected-lang {
            background-color: #e9d5ff;
            border: 2px solid #9333ea;
            color: #6b21a8;
            font-weight: bold;
        }
        .feedback-link {
            transition: background-color 0.2s ease;
        }
        .feedback-link:active {
            background-color: #e5e7eb;
        }
        .star-rating input[type="radio"] {
            display: none;
        }
        .star-rating label {
            font-size: 2rem;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star-rating input[type="radio"]:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #f59e0b;
        }
        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
        }
        #feedback-modal .overflow-y-auto::-webkit-scrollbar {
            display: none;
        }
        #feedback-modal .overflow-y-auto {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        .animated-thumb {
            animation: bounce-in 0.6s ease-out;
        }
        #hand-icon {
            position: absolute;
            font-size: 40px;
            z-index: 99;
            pointer-events: none;
            transition: top 0.2s ease-out, left 0.2s ease-out;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
        }
        @keyframes tap-animation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.85); }
        }
        .tapping {
            animation: tap-animation 0.5s ease-in-out;
        }
        .lang-dropdown {
            position: relative;
            display: inline-block;
            z-index: 20;
        }
        .lang-dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 100px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 21;
            border-radius: 8px;
            padding: 8px 0;
            right: 0;
            left: auto;
        }
        .lang-dropdown-content.show {
            display: block;
        }
        .lang-dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .lang-dropdown-content a:hover {background-color: #f1f1f1}
        @keyframes pump {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .pumping {
            animation: pump 1s infinite;
        }
        .highlight-text {
            color: #3b82f6;
            font-weight: bold;
            margin-top: 8px;
        }
        .score-card {
            background-color: #dbeafe;
            border: 2px solid #bfdbfe;
        }
        @keyframes shake {
          10%, 90% {
            transform: translate3d(-1px, 0, 0);
          }
          20%, 80% {
            transform: translate3d(2px, 0, 0);
          }
          30%, 50%, 70% {
            transform: translate3d(-4px, 0, 0);
          }
          40%, 60% {
            transform: translate3d(4px, 0, 0);
          }
        }
        .shake {
          animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }
        .blurb {
            position: absolute;
            background-color: #1f2937;
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 25px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
        }
        .blurb::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px 15px rgba(59, 130, 246, 0.7); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        .animated-arrow { animation: bounce 2s infinite; }
        #add-row-blurb, #hint-blurb {
            white-space: normal;
            text-align: center;
            width: 120px;
            height: 120px;
            padding: 12px;
            justify-content: center;
            transform: translateX(-50%);
        }
        #unlock-toast {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 12px 24px;
            border-radius: 12px;
            background-color: #dbeafe;
            color: #2563eb;
            font-weight: bold;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }
        #slide-in-toast {
            position: absolute;
            bottom: 20px;
            left: -110%;
            width: 90%;
            margin-left: 5%;
            margin-right: 5%;
            background-color: rgba(31, 41, 55, 0.9);
            color: white;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            z-index: 45;
        @keyframes bounce-down {
          0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
          }
          40% {
            transform: translateY(-20px);
          }
          60% {
            transform: translateY(-10px);
          }
        }
        .arrow-bounce {
            animation: bounce-down 2s infinite;
        }
        .no-pointer {
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.left-1\/2{left:50%}.right-2{right:0.5rem}.top-2{top:0.5rem}.top-\[35\%\]{top:35%}.z-20{z-index:20}.z-50{z-index:50}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-24{height:6rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-full{height:100%}.max-h-\[90vh\]{max-height:90vh}.min-h-screen{min-height:100vh}.w-10{width:2.5rem}.w-11\/12{width:91.666667%}.w-24{width:6rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-full{width:100%}.max-w-sm{max-width:24rem}.max-w-xs{max-width:20rem}.flex-shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%, 100%{transform:translateY(-25%);animation-timing-function:cubic-bezier(0.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,0.2,1)}}.animate-bounce{animation:bounce 1s infinite}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-5{grid-template-columns:repeat(5, minmax(0, 1fr))}.grid-cols-9{grid-template-columns:repeat(9, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-8{gap:2rem}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-l{border-left-width:1px}.border-t{border-top-width:1px}.border-blue-400{--tw-border-opacity:1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity:1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-400{--tw-bg-opacity:1;background-color:rgb(250 204 21 / var(--tw-bg-opacity, 1))}.bg-opacity-80{--tw-bg-opacity:0.8}.p-2{padding:0.5rem}.p-1{padding:0.25rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.pb-6{padding-bottom:1.5rem}.pt-12{padding-top:3rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-purple-700{--tw-text-opacity:1;color:rgb(126 34 206 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:bg-blue-100:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-200:hover{--tw-bg-opacity:1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-400:hover{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-200:hover{--tw-bg-opacity:1;background-color:rgb(233 213 255 / var(--tw-bg-opacity, 1))}.hover\:text-gray-600:hover{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:bg-gray-400:disabled{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity, 1))}@media (min-width: 640px){.sm\:max-w-md{max-width:28rem}.sm\:gap-8{gap:2rem}.sm\:p-3{padding:0.75rem}.sm\:p-4{padding:1rem}.sm\:p-8{padding:2rem}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:text-sm{font-size:0.875rem;line-height:1.25rem}}</style></head>
<body class="flex items-center justify-center min-h-screen p-2">
    <audio id="match-success-sound" src="https://codeskulptor-demos.commondatastorage.googleapis.com/descent/gotitem.mp3" preload="auto"></audio>
    <audio id="match-fail-sound" src="https://codeskulptor-assets.commondatastorage.googleapis.com/assets_buzzer.mp3" preload="auto"></audio>
    <audio id="win-sound" src="https://commondatastorage.googleapis.com/codeskulptor-assets/week7-brrring.m4a" preload="auto"></audio>
    <audio id="click-sound" src="https://commondatastorage.googleapis.com/codeskulptor-assets/sounddogs/click.mp3" preload="auto"></audio>
    <!-- Add these lines for your custom language voices. Replace the SRC with your public URLs -->
    <audio id="hint-sound-kn" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/kannada%20hint.mp3" preload="auto"></audio>
    <audio id="hint-sound-ta" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/Tamil%20Hint.mp3" preload="auto"></audio>
    <audio id="hint-sound-te" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/Telugu%20hint.mp3" preload="auto"></audio>
    <!-- Voiceovers for the low matches toast message -->
    <audio id="toast-sound-en" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/English%20Toast.mp3" preload="auto"></audio>
    <audio id="toast-sound-hi" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/Hindi%20Toast.mp3" preload="auto"></audio>
    <audio id="toast-sound-kn" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/kannada%20Toast.mp3" preload="auto"></audio>
    <audio id="toast-sound-ta" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/Tamil%20Toast.mp3" preload="auto"></audio>
    <audio id="toast-sound-te" src="https://raw.githubusercontent.com/sneha-xorstack/teluskoTraining/master/Telugu%20Toast.mp3" preload="auto"></audio>

    <div id="app-wrapper" class="relative w-full h-full sm:max-w-md mx-auto overflow-hidden rounded-3xl flex items-center">
        <div id="hand-icon" class="tapping" style="top: 501px; left: 204px;">👇</div>
        <canvas id="effect-canvas" width="448" height="704"></canvas>
        <svg id="line-svg-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:41;"></svg>
        <div id="unlock-toast" class="hidden"></div>
        <div id="language-selection-screen" class="w-full h-full p-6 sm:p-8 rounded-3xl shadow-2xl text-center flex flex-col justify-center hidden" style="background-color: #ADD8E6;">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-8">Choose Your Language</h1>
            <div class="space-y-4">
                <button class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 initial-lang-btn" data-lang-code="en">English</button>
                <button class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 initial-lang-btn" data-lang-code="hi">हिन्दी</button>
                <button class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 initial-lang-btn" data-lang-code="kn">ಕನ್ನಡ</button>
                <button class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 initial-lang-btn" data-lang-code="ta">தமிழ்</button>
                <button class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 initial-lang-btn" data-lang-code="te">తెలుగు</button>
            </div>
        </div>
        <div id="home-screen" class="w-full h-full bg-blue-50 p-6 sm:p-8 rounded-3xl shadow-2xl text-center flex flex-col justify-center hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-4">SumLink</h1>
            <button id="continue-game-btn" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl mb-4 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed" data-lang="continue">Continue</button>
            <button id="new-game-btn" class="w-full text-white font-bold py-3 rounded-xl mb-4" style="background-color: #002387;" data-lang="new_game">New Game</button>
            <button id="home-settings-btn" class="w-full text-white font-bold py-3 rounded-xl mb-4" style="background-color: #8A9A5B;" data-lang="settings">Settings</button>
            <div class="w-full bg-white text-gray-800 font-bold py-3 rounded-xl mb-4 shadow">
                <span data-lang="best">Best</span>: <span id="home-best-score-value">0</span>
            </div>
        </div>
        <div id="tutorial-container" class="w-full bg-white p-2 sm:p-4 rounded-2xl shadow-lg flex flex-col justify-center h-full relative">
            <div id="tutorial-spotlight" class="absolute inset-0 bg-black bg-opacity-80 z-50 hidden flex-col p-6">
                <div id="tutorial-arrow" class="animated-arrow text-5xl text-white absolute hidden">👇</div>
                <!-- This container holds the spotlight content -->
                <div class="relative z-20 flex flex-col h-full">
                    <!-- Dimmed Grid for context -->
                    <div style="opacity: 0.05;">
                        <header class="flex items-center justify-center relative mb-6">
                            <h1 class="text-2xl font-bold text-gray-800">Tutorial!</h1>
                        </header>
                        <div class="game-grid-container-dimmed grid grid-cols-5 border-t border-l border-gray-200 rounded-lg overflow-hidden"></div>
                    </div>
                    <!-- Message Box -->
                    <div class="absolute top-[35%] left-1/2 -translate-x-1/2 w-11/12 max-w-sm bg-white border-2 border-blue-400 rounded-xl shadow-lg p-4 text-center">
                        <p id="spotlight-message-text" class="text-lg font-semibold text-gray-800"></p>
                    </div>
                    <!-- Spacer -->
                    <div class="flex-grow"></div>
                    <!-- The arrow has been moved out to be positioned absolutely -->
                </div>
            </div>
            
            <div id="tutorial-main-content">
                <div class="flex justify-between items-start mb-8">
                    <div class="w-8"></div>
                    <div class="text-center">
                        <h1 class="text-2xl font-bold text-gray-700 mb-4" data-lang="how_to_play_title">Tutorial!</h1>
                        <p id="tutorial-equation" class="text-4xl font-semibold hidden">3 + 7 = 10</p>
                    </div>
                    <div class="lang-dropdown">
                        <button id="lang-select-btn" class="text-sm font-bold text-purple-700 p-1 rounded-lg bg-purple-100 hover:bg-purple-200 w-8 h-8 flex items-center justify-center">EN</button>
                        <div id="lang-dropdown-content" class="lang-dropdown-content">
                            <a href="#" class="lang-option" data-lang-code="en" data-lang="lang_en">English</a>
                            <a href="#" class="lang-option" data-lang-code="hi" data-lang="lang_hi">हिन्दी</a>
                            <a href="#" class="lang-option" data-lang-code="kn" data-lang="lang_kn">ಕನ್ನಡ</a>
                            <a href="#" class="lang-option" data-lang-code="ta" data-lang="lang_ta">தமிழ்</a>
                            <a href="#" class="lang-option" data-lang-code="te" data-lang="lang_te">తెలుగు</a>
                        </div>
                    </div>
                </div>
                <div class="game-grid-container grid grid-cols-5 mb-4"><div class="grid-cell flex items-center justify-center"><span class="number-text">3</span></div><div class="grid-cell flex items-center justify-center blurred"><span class="number-text">4</span></div><div class="grid-cell flex items-center justify-center"><span class="number-text">6</span></div><div class="grid-cell flex items-center justify-center"><span class="number-text">9</span></div><div class="grid-cell flex items-center justify-center blurred"><span class="number-text">1</span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div><div class="grid-cell flex items-center justify-center cleared"><span class="number-text"></span></div></div>
                <div id="tutorial-text-container" class="text-center">
                    <h3 id="tutorial-title" class="text-2xl sm:text-3xl font-bold text-blue-800 mb-2">Add More Numbers</h3>
                    <div id="tutorial-info-box" class="mb-4">
                        <p id="tutorial-text" class="text-sm text-gray-700">No moves left? Tap '+' to add more numbers!</p>
                        <div class="flex justify-center items-center mt-1">
                            <span id="tutorial-progress" class="text-xs font-medium text-gray-500"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div id="tutorial-controls-footer" class="w-full flex items-center justify-center gap-8 pt-12">
                    <div id="add-numbers-section-tutorial" class="relative text-center">
                        <button id="add-btn-tutorial" class="control-button bg-blue-500 text-white flex items-center justify-center text-4xl mx-auto">+</button>
                        <div id="add-btn-tutorial-blurb" class="blurb hidden" data-lang="add_numbers_blurb">Add numbers to continue</div>
                    </div>
                    <div id="hint-section-tutorial" class="relative text-center hidden">
                        <button id="tutorial-hint-btn" class="control-button bg-yellow-400 text-white flex items-center justify-center text-4xl">💡</button>
                        <div id="hint-btn-tutorial-blurb" class="blurb hidden" data-lang="hint_blurb">Show a Hint</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="game-container" class="w-full h-full bg-blue-50 p-2 rounded-3xl shadow-2xl hidden flex flex-col">
            <header class="flex items-center justify-between mb-1 px-2 flex-shrink-0">
                <button id="back-btn" class="text-blue-600 w-10 h-10 flex items-center justify-center rounded-lg hover:bg-blue-100">
                    <img src="https://i.postimg.cc/HxgY62WT/png-clipart-computer-icons-home-house-desktop-service-home-blue-logo-thumbnail-removebg-preview.png" alt="Home" class="w-6 h-6">
                </button>
                <h2 id="stage-title" class="text-xl font-bold text-blue-800" data-lang-prefix="stage">Stage 1</h2>
                <div class="flex items-center gap-2">
                    <button id="pause-btn" class="text-blue-600 text-2xl w-10 h-10 flex items-center justify-center rounded-lg hover:bg-blue-100">⏸️</button>
                    <div class="lang-dropdown">
                        <button id="game-lang-select-btn" class="text-sm font-bold text-purple-700 p-2 rounded-lg bg-purple-100 hover:bg-purple-200 w-8 h-8 flex items-center justify-center">EN</button>
                        <div class="lang-dropdown-content">
                            <a href="#" class="lang-option" data-lang-code="en" data-lang="lang_en">English</a>
                            <a href="#" class="lang-option" data-lang-code="hi" data-lang="lang_hi">हिन्दी</a>
                            <a href="#" class="lang-option" data-lang-code="kn" data-lang="lang_kn">ಕನ್ನಡ</a>
                            <a href="#" class="lang-option" data-lang-code="ta" data-lang="lang_ta">தமிழ்</a>
                            <a href="#" class="lang-option" data-lang-code="te" data-lang="lang_te">తెలుగు</a>
                        </div>
                    </div>
                </div>
            </header>
            <div class="grid grid-cols-2 gap-4 mb-1 flex-shrink-0">
                <div class="score-card p-2 sm:p-3 rounded-xl text-center shadow">
                    <p class="text-xs sm:text-sm text-gray-500 flex items-center justify-center gap-1" data-lang="score">Score</p>
                    <p id="current-score" class="text-lg sm:text-2xl font-bold text-gray-800">0</p>
                </div>
                <div class="score-card p-2 sm:p-3 rounded-xl text-center shadow">
                    <p class="text-xs sm:text-sm text-gray-500 flex items-center justify-center gap-1" data-lang="best">Best</p>
                    <p id="best-score" class="text-lg sm:text-2xl font-bold text-gray-800">0</p>
                </div>
            </div>
            <div id="main-game-grid-wrapper" class="bg-white rounded-lg relative overflow-hidden flex-grow">
                <div id="main-game-grid" class="game-grid-container grid grid-cols-9"></div>
                <div id="slide-in-toast"></div>
            </div>
            <footer class="py-1 flex-shrink-0 pb-6">
                 <div class="flex flex-col items-center gap-1">
                      <div class="flex items-start justify-around w-full gap-4 sm:gap-8">
                           <div class="relative">
                              <button id="whatsapp-share-btn" class="control-button bg-green-500 text-white flex items-center justify-center p-4">
                                  <svg xmlns="http://www.w.org/2000/svg" width="100%" height="100%" fill="currentColor" viewBox="0 0 16 16">
                                      <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"></path>
                                  </svg>
                              </button>
                           </div>
                           <div class="relative flex flex-col items-center">
                                <button id="add-row-btn" class="control-button bg-blue-500 text-white flex items-center justify-center text-4xl">+</button>
                                <span id="add-row-badge" class="badge bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center no-pointer">5</span>
                                <div id="add-row-blurb" class="blurb hidden" data-lang="add_numbers_blurb">Add numbers to continue</div>
                                <button id="feedback-btn" class="text-sm text-green-600 underline mt-2" data-lang="feedback">Feedback</button>
                           </div>
                           <div class="relative">
                              <button id="hint-btn" class="control-button bg-yellow-400 text-white flex items-center justify-center">💡</button>
                              <span id="hint-badge" class="badge bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center no-pointer">3</span>
                              <div id="hint-blurb" class="blurb hidden" data-lang="hint_blurb">Show a Hint</div>
                           </div>
                      </div>
                 </div>
            </footer>
        </div>
    </div>

    <div id="pause-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-xs p-6 rounded-2xl shadow-xl text-center relative">
            <button id="close-pause-modal" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-gray-600">×</button>
            <h3 class="text-2xl font-bold mb-4" data-lang="paused">Paused</h3>
            <button id="how-to-play-btn" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl mb-3 hover:bg-blue-600" data-lang="how_to_play">💡 Tutorial!</button>
            <div class="flex flex-col gap-3">
                <button id="retry-btn" class="w-full bg-gray-300 text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-400" data-lang="retry">Retry</button>
                <button id="continue-btn" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl hover:bg-blue-600" data-lang="continue">Continue</button>
            </div>
        </div>
    </div>
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-xs p-6 rounded-2xl shadow-xl text-center relative">
            <button id="close-settings-modal" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-gray-600">×</button>
            <h3 class="text-2xl font-bold mb-4" data-lang="settings">Settings</h3>
            <div class="mb-6">
                <h4 class="text-xl font-bold mb-2" data-lang="sound">Sound</h4>
                <button id="sound-toggle-btn" class="bg-blue-100 text-blue-600 text-4xl p-4 rounded-xl hover:bg-blue-200 w-24">🔊</button>
            </div>
            <div>
                <h4 class="text-xl font-bold mb-2" data-lang="language">Language</h4>
                <div class="grid grid-cols-2 gap-3">
                    <button class="lang-btn text-lg p-2 rounded-md hover:bg-gray-200 selected-lang" data-lang-code="en">English</button>
                    <button class="lang-btn text-lg p-2 rounded-md hover:bg-gray-200" data-lang-code="hi">हिन्दी</button>
                    <button class="lang-btn text-lg p-2 rounded-md hover:bg-gray-200" data-lang-code="kn">ಕನ್ನಡ</button>
                    <button class="lang-btn text-lg p-2 rounded-md hover:bg-gray-200" data-lang-code="ta">தமிழ்</button>
                    <button class="lang-btn text-lg p-2 rounded-md hover:bg-gray-200" data-lang-code="te">తెలుగు</button>
                </div>
            </div>
        </div>
    </div>
    <div id="feedback-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl relative max-h-[90vh] overflow-y-auto mx-4">
            <button id="close-feedback-modal" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-gray-600">×</button>
            <form id="feedback-form" class="space-y-4 text-left">
                <div>
                    <label class="font-semibold text-gray-700 block text-center mb-1" data-lang="form_rate_exp">Rate Your Experience</label>
                    <div class="star-rating">
                        <input type="radio" id="star5" name="rating" value="5" style=""><label for="star5">★</label>
                        <input type="radio" id="star4" name="rating" value="4" style=""><label for="star4">★</label>
                        <input type="radio" id="star3" name="rating" value="3" style=""><label for="star3">★</label>
                        <input type="radio" id="star2" name="rating" value="2" style=""><label for="star2">★</label>
                        <input type="radio" id="star1" name="rating" value="1" style=""><label for="star1">★</label>
                    </div>
                </div>
                <div>
                    <textarea id="review-message" data-placeholder-lang="form_placeholder" name="comment" class="w-full h-24 p-2 border rounded-md mt-1" placeholder="Help us improve the Game" style=""></textarea>
                </div>
                <p id="feedback-error" class="text-red-500 text-sm text-center hidden"></p>
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-feedback-btn" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl hover:bg-gray-400" data-lang="cancel">Cancel</button>
                    <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-blue-600" data-lang="submit" disabled="">Submitting...</button>
                </div>
            </form>
        </div>
    </div>
    <div id="thank-you-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-xs p-8 rounded-2xl shadow-xl text-center relative">
            <button id="close-thank-you-modal" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-gray-600">×</button>
            <div id="thank-you-thumb-container" class="w-24 h-24 mx-auto mb-4">
                <svg id="thank-you-thumb" class="w-full h-full text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.562 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"></path></svg>
            </div>
            <h3 class="text-2xl font-bold" data-lang="thank_you">Thank you for the feedback!</h3>
        </div>
    </div>
    <div id="win-animation" class="modal-overlay hidden flex-col">
        <canvas id="win-canvas"></canvas>
        <div class="text-center text-white stage-transition-message">
            <h2 id="win-message" class="text-4xl font-bold animate-bounce"></h2>
        </div>
    </div>
    <div id="stage-start-modal" class="modal-overlay hidden">
        <div class="text-center text-white stage-transition-message">
            <h2 id="stage-start-message" class="text-4xl font-bold animate-bounce"></h2>
        </div>
    </div>
    <div id="game-over-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl text-center relative">
            <button id="close-game-over-modal" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-gray-600">×</button>
            <h3 class="text-2xl font-bold mb-6" data-lang="game_over_title">Out of Moves!</h3>
            <div class="flex justify-center gap-4">
                <button id="game-over-home-btn" class="bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-xl hover:bg-gray-400" data-lang="home">Home</button>
                <button id="try-again-btn" class="bg-blue-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-600" data-lang="try_again">Try Again</button>
            </div>
        </div>
    </div>

    <div id="new-game-confirm-modal" class="modal-overlay hidden">
        <div class="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl text-center relative">
            <h3 class="text-xl font-bold mb-4" data-lang="new_game_confirm_title">Start a New Game?</h3>
            <p class="text-gray-600 mb-6" data-lang="new_game_confirm_text">This will erase your current progress and start from stage 1. Are you sure?</p>
            <div class="flex justify-center gap-4">
                <button id="new-game-confirm-no-btn" class="bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-xl hover:bg-gray-400" data-lang="no">No</button>
                <button id="new-game-confirm-yes-btn" class="bg-blue-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-600" data-lang="yes">Yes</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" crossorigin="anonymous" src="https://us-assets.i.posthog.com/static/surveys.js?v=1.270.1"></script><script type="text/javascript" crossorigin="anonymous" src="https://us-assets.i.posthog.com/static/recorder.js?v=1.270.1"></script><script type="text/javascript" crossorigin="anonymous" src="https://us-assets.i.posthog.com/array/phc_BLLJRB5R4OuRU4u72Sagt5LE99ueBMZ1DmrHH8uksJs/config.js"></script><script>
        document.addEventListener('DOMContentLoaded', () => {
            let soundEnabled = true;
            let audioInitialized = false;
            let nextStageDataForCallback = null;
            let comboCount = 0;

            const matchSuccessSound = document.getElementById('match-success-sound');
            const matchFailSound = document.getElementById('match-fail-sound');
            const winSound = document.getElementById('win-sound');
            const clickSound = document.getElementById('click-sound');

            const langCodeMap = {
                en: 'en-US',
                hi: 'hi-IN',
                kn: 'kn-IN',
                ta: 'ta-IN',
                te: 'te-IN'
            };

            function trackEvent(eventName, eventParams = {}) {
                console.log(`GA Event Fired: ${eventName}`, eventParams);
                if (typeof gtag === 'function') {
                    gtag('event', eventName, eventParams);
                }
                
                // Map GA events to Meta Pixel events
                const metaEventMap = {
                    'session_start': 'PageView',
                    'language_selected': 'ViewContent',
                    'game_start': 'AddToCart',
                    'level_start': 'ViewContent',
                    'level_complete': 'Purchase',
                    'level_failed': 'AddPaymentInfo',
                    'level_retry': 'AddToCart',
                    'match_made': 'AddToCart',
                    'match_failed': 'AddPaymentInfo',
                    'game_action': 'AddToCart',
                    'game_paused': 'AddPaymentInfo',
                    'navigation_to_home': 'ViewContent',
                    'settings_opened': 'ViewContent',
                    'cta_clicked': 'Lead',
                    'form_submitted': 'CompleteRegistration',
                    'game_over_action': 'Purchase',
                    'share_clicked': 'Share',
                    'tutorial_step': 'ViewContent',
                    'tutorial_completed': 'Purchase',
                    'tutorial_match_made': 'AddToCart',
                    'tutorial_match_failed': 'AddPaymentInfo'
                };

                const metaEventName = metaEventMap[eventName] || 'ViewContent';
                
                // Send to Meta Pixel
                if (typeof fbq === 'function') {
                    fbq('track', metaEventName, {
                        content_name: eventName,
                        content_category: 'Game',
                        content_ids: [eventParams.level_number || 'general'],
                        content_type: 'product',
                        value: eventParams.score || 0,
                        currency: 'USD',
                        ...eventParams
                    });
                }
            }

            function speakText(text) {
                if (!soundEnabled || !('speechSynthesis' in window)) return;
                speechSynthesis.cancel(); // Stop any previous speech
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = langCodeMap[currentLang] || currentLang;
                speechSynthesis.speak(utterance);
            }

            function initAudio() {
                if (audioInitialized) return;
                const sounds = [
                    matchSuccessSound, matchFailSound, winSound, clickSound,
                    document.getElementById('hint-sound-kn'),
                    document.getElementById('hint-sound-ta'),
                    document.getElementById('hint-sound-te'),
                    document.getElementById('toast-sound-en'),
                    document.getElementById('toast-sound-hi'),
                    document.getElementById('toast-sound-kn'),
                    document.getElementById('toast-sound-ta'),
                    document.getElementById('toast-sound-te')
                ];
                sounds.forEach(sound => {
                    if (sound) { // Check if element exists
                        sound.play().then(() => {
                            sound.pause();
                            sound.currentTime = 0;
                        }).catch(error => {
                            console.log("Audio context unlock failed, will try again on next interaction.");
                        });
                    }
                });
                audioInitialized = true;
            }
            
            function playSound(type = 'click') {
                if (!audioInitialized) {
                    initAudio();
                }
                if (!soundEnabled) return;

                let soundToPlay;
                switch (type) {
                    case 'win':
                        soundToPlay = winSound;
                        break;
                    case 'combo':
                    case 'normal':
                        soundToPlay = matchSuccessSound;
                        if (type === 'combo' && comboCount > 1) {
                            soundToPlay.playbackRate = 1 + (comboCount * 0.1);
                        } else {
                            soundToPlay.playbackRate = 1;
                        }
                        break;
                    case 'error':
                        soundToPlay = matchFailSound;
                        break;
                    case 'click':
                    default:
                        soundToPlay = clickSound;
                        break;
                }
                if (soundToPlay) {
                    soundToPlay.currentTime = 0;
                    soundToPlay.play().catch(error => console.log(`Audio play failed: ${error}`));
                }
            }

            function playHintSound() {
                if (!soundEnabled) return;

                const hintAudioMap = {
                    kn: document.getElementById('hint-sound-kn'),
                    ta: document.getElementById('hint-sound-ta'),
                    te: document.getElementById('hint-sound-te')
                };

                const audio = hintAudioMap[currentLang];

                // Check if a custom audio element exists for the current language and has a real URL
                if (audio && audio.src && !audio.src.includes('YOUR_PUBLIC_URL')) {
                    if (!audioInitialized) initAudio();
                    audio.currentTime = 0;
                    audio.play().catch(e => console.error("Error playing custom hint sound:", e));
                } else {
                    // Fallback to browser TTS for other languages like English and Hindi
                    speakText(translations[currentLang].hint_blurb);
                }
            }
            
            function playLowMatchesSound() {
                if (!soundEnabled) return;

                const toastAudioMap = {
                    en: document.getElementById('toast-sound-en'),
                    hi: document.getElementById('toast-sound-hi'),
                    kn: document.getElementById('toast-sound-kn'),
                    ta: document.getElementById('toast-sound-ta'),
                    te: document.getElementById('toast-sound-te')
                };

                const audio = toastAudioMap[currentLang];
                if (audio && audio.src) {
                    if (!audioInitialized) initAudio();
                    audio.currentTime = 0;
                    audio.play().catch(e => console.error("Error playing toast sound:", e));
                }
            }

            const translations = {
                en: {
                    how_to_play_title: "Tutorial!", lang_en: "English", lang_hi: "हिन्दी", lang_kn: "ಕನ್ನಡ", lang_ta: "தமிழ்", lang_te: "తెలుగు", lang_code_short: "EN", title: "Number Match", stage: "Stage", score: "Score", best: "Best", paused: "Paused", how_to_play: "💡 Tutorial!", retry: "Retry", continue: "Continue", language: "Language", new_game: "New Game", skip: "Skip", settings: "Settings", sound: "Sound", feedback_title: "Help us make Number Match even more fun!", feedback_title_new: "Help us make Number Match even more fun!", feedback_desc_new: "We’re always improving the game for you! Share your thoughts and get 50 bonus coins as a thank-you.", form_name: "Name / Nickname (Optional)", form_email: "Email (Optional)", form_rate_exp: "Rate Your Experience", form_enjoy_most_new: "What do you enjoy most about the game?", form_enjoy_finding_pairs: "Finding matching pairs quickly", form_enjoy_challenge_timer: "The challenge/timer", form_enjoy_colors: "The colorful numbers and tiles", form_enjoy_unlocking: "Unlocking new levels", form_improve_new: "What should we improve?", form_improve_time: "More time for levels", form_improve_controls: "Easier controls/tapping accuracy", form_improve_themes: "More themes or tile designs", form_improve_patterns: "More challenging number patterns", form_improve_sounds: "Sounds and background music", form_comments: "Any other comments?", form_consent_new: "I agree to share my feedback to help improve the game.", submit: "Submit Feedback", thank_you: "Thank you for the feedback!",
                    tut_title_1: "Find Pair Of Numbers", tut_text_1: "Find Pair of numbers that are same, or whose sum is 10 and tap them",
                    tut_title_2: "Sum to 10", tut_text_2: "Horizontally, Vertically, or Diagonally pairs can still be made.",
                    tut_title_3: "Check Line by Next Line", tut_text_3: "Remember to check the end of one line and the start of the next,as they might form pairs",
                    tut_title_4: "Pair Different Directions", tut_text_4: "",
                    tut_title_5: "Match Diagonally", tut_text_5: "Number Separated by <b>INACTIVE</b> cells can be paired or sum diagonally",
                    tut_title_6: "Check Line by Next Line", tut_text_6: "Remember to check the end of one line and the start of the next,as they might form pairs",
                    tut_title_7: "Add More Numbers", tut_text_7: "No moves left? Tap '+' to add more numbers!",
                    tut_title_8: "Clear the Board!", tut_text_8: "Use the Pairing rules to clear the board. Use hints if you're stuck!",
                    tut_add_btn_text: "Click on + BUTTON", tut_hint_btn_text: "Take a hint",
                    tut_complete_title: "Congratulations!", tut_complete_text: "You've learned the basics!",
                    win_tutorial_complete: "Tutorial Complete! 🎉", win_stage_cleared: "Stage Cleared! 🎉",
                    cancel: "Cancel", form_placeholder: "Help us improve the Game", feedback: "Feedback", add_numbers_blurb: "Add numbers to continue", hint_blurb: "Show a Hint", game_over_title: "Out of Moves!", try_again: "Try Again", home: "Home",
                    unlock_toast_message: "Clear {} more matches to unlock Add Row",
                    objective_toast: "Clear the board numbers",
                    get_ready: "Get Ready!",
                    new_game_confirm_title: "Start a New Game?",
                    new_game_confirm_text: "This will erase your current progress and start from stage 1. Are you sure?",
                    yes: "Yes",
                    no: "No"
                },
                hi: {
                    how_to_play_title: "ट्यूटोरियल!", lang_en: "English", lang_hi: "हिन्दी", lang_kn: "ಕನ್ನಡ", lang_ta: "தமிழ்", lang_te: "తెలుగు", lang_code_short: "हि", title: "नंबर मैच", stage: "मंच", score: "स्कोर", best: "सर्वश्रेष्ठ", paused: "रोक दिया", how_to_play: "💡 ट्यूटोरियल!", retry: "पुनः प्रयास करें", continue: "जारी रखें", language: "भाषा", new_game: "नया खेल", skip: "छोड़ें", settings: "सेटिंग्स", sound: "ध्वनि", feedback_title: "नंबर मैच को और भी मजेदार बनाने में हमारी मदद करें!", feedback_title_new: "नंबर मैच को और भी मजेदार बनाने में हमारी मदद करें!", feedback_desc_new: "हम आपके लिए हमेशा खेल में सुधार कर रहे हैं! अपने विचार साझा करें और धन्यवाद के रूप में 50 बोनस सिक्के प्राप्त करें।", form_name: "नाम / उपनाम (वैकल्पिक)", form_email: "ईमेल (वैकल्पिक)", form_rate_exp: "अपने अनुभव को रेट करें", form_enjoy_most_new: "आपको खेल में सबसे ज्यादा क्या पसंद है?", form_enjoy_finding_pairs: "जल्दी से मेल खाने वाले जोड़े ढूंढना", form_enjoy_challenge_timer: "चुनौती/टाइमर", form_enjoy_colors: "रंगीन संख्याएं और टाइलें", form_enjoy_unlocking: "नए स्तरों को अनलॉक करना", form_improve_new: "हमें क्या सुधार करना चाहिए?", form_improve_time: "स्तरों के लिए अधिक समय", form_improve_controls: "आसान नियंत्रण/टैपिंग सटीकता", form_improve_themes: "अधिक थीम या टाइल डिजाइन", form_improve_patterns: "अधिक चुनौतीपूर्ण संख्या पैटर्न", form_improve_sounds: "ध्वनि और पृष्ठभूमि संगीत", form_comments: "कोई अन्य टिप्पणी?", form_consent_new: "मैं खेल को बेहतर बनाने में मदद के लिए अपनी प्रतिक्रिया साझा करने के लिए सहमत हूं।", submit: "प्रतिक्रिया भेजें", thank_you: "प्रतिक्रिया के लिए धन्यवाद!",
                    tut_title_1: "संख्याओं की जोड़ी खोजें", tut_text_1: "समान संख्याओं की जोड़ी खोजें, या जिनका योग 10 हो और उन्हें टैप करें",
                    tut_title_2: "योग 10", tut_text_2: "क्षैतिज, लंबवत, या विकर्ण जोड़े अभी भी बनाए जा सकते हैं।",
                    tut_title_3: "अगली लाइन से लाइन जांचें", tut_text_3: "एक मैच एक लाइन के अंत से अगली लाइन की शुरुआत तक हो सकता है।",
                    tut_title_4: "अलग-अलग दिशाओं में जोड़ी बनाएं", tut_text_4: "",
                    tut_title_5: "तिरछे मैच करें", tut_text_5: "<b>निष्क्रिय</b> कोशिकाओं द्वारा अलग की गई संख्या को तिरछे जोड़ा या योग किया जा सकता है",
                    tut_title_6: "अगली लाइन से लाइन जांचें", tut_text_6: "एक मैच एक लाइन के अंत से अगली लाइन की शुरुआत तक हो सकता है।",
                    tut_title_7: "और नंबर जोड़ें", tut_text_7: "कोई चाल नहीं बची? अधिक संख्याएँ जोड़ने के लिए '+' पर टैप करें!",
                    tut_title_8: "बोर्ड साफ़ करें!", tut_text_8: "बोर्ड को साफ़ करने के लिए पेयरिंग नियमों का उपयोग करें। यदि आप फंस गए हैं तो संकेतों का उपयोग करें!",
                    tut_add_btn_text: "+ बटन पर क्लिक करें", tut_hint_btn_text: "संकेत लें",
                    tut_complete_title: "बधाई हो!", tut_complete_text: "आपने मूल बातें सीख ली हैं!",
                    win_tutorial_complete: "ट्यूटोरियल पूरा! 🎉", win_stage_cleared: "मंच साफ़! 🎉",
                    cancel: "रद्द करें", form_placeholder: "खेल को बेहतर बनाने में हमारी मदद करें", feedback: "प्रतिक्रिया", add_numbers_blurb: "जारी रखने के लिए नंबर जोड़ें", hint_blurb: "संकेत दिखाएँ", game_over_title: "चालें खत्म!", try_again: "पुनः प्रयास करें", home: "होम",
                    unlock_toast_message: "'Add Row' अनलॉक करने के लिए {} और मैच साफ़ करें",
                    objective_toast: "बोर्ड के नंबर साफ़ करें",
                    get_ready: "तैयार हो जाओ!",
                    new_game_confirm_title: "नया खेल शुरू करें?",
                    new_game_confirm_text: "यह आपकी वर्तमान प्रगति को मिटा देगा और चरण 1 से शुरू होगा। क्या आप निश्चित हैं?",
                    yes: "हाँ",
                    no: "नहीं"
                },
                kn: {
                    how_to_play_title: "ಟ್ಯುಟೋರಿಯಲ್!", lang_en: "English", lang_hi: "हिन्दी", lang_kn: "ಕನ್ನಡ", lang_ta: "தமிழ்", lang_te: "తెలుగు", lang_code_short: "ಕ", title: "ಸಂಖ್ಯೆ ಹೊಂದಾಣಿಕೆ", stage: "ಹಂತ", score: "ಅಂಕ", best: "ಅತ್ಯುತ್ತಮ", paused: "ವಿರಾಮ", how_to_play: "💡 ಟ್ಯುಟೋರಿಯಲ್!", retry: "ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ", continue: "ಮುಂದುವರಿಸಿ", language: "ಭಾಷೆ", new_game: "ಹೊಸ ಆಟ", skip: "ಸ್ಕಿಪ್", settings: "ಸಂಯೋಜನೆಗಳು", sound: "ಶಬ್ದ", feedback_title: "ಸಂಖ್ಯೆ ಹೊಂದಾಣಿಕೆಯನ್ನು ಇನ್ನಷ್ಟು ಮೋಜಿನ ಮಾಡಲು ನಮಗೆ ಸಹಾಯ ಮಾಡಿ!", feedback_title_new: "ಸಂಖ್ಯೆ ಹೊಂದಾಣಿಕೆಯನ್ನು ಇನ್ನಷ್ಟು ಮೋಜಿನ ಮಾಡಲು ನಮಗೆ ಸಹಾಯ ಮಾಡಿ!", feedback_desc_new: "ನಾವು ನಿಮಗಾಗಿ ಯಾವಾಗಲೂ ಆಟವನ್ನು ಸುಧಾರಿಸುತ್ತಿದ್ದೇವೆ! ನಿಮ್ಮ ಆಲೋಚನೆಗಳನ್ನು ಹಂಚಿಕೊಳ್ಳಿ ಮತ್ತು ಧನ್ಯವಾದವಾಗಿ 50 ಬೋನಸ್ ನಾಣ್ಯಗಳನ್ನು ಪಡೆಯಿರಿ.", form_name: "ಹೆಸರು / ಅಡ್ಡಹೆಸರು (ಐಚ್ಛಿಕ)", form_email: "ಇಮೇಲ್ (ಐಚ್ಛಿಕ)", form_rate_exp: "ನಿಮ್ಮ ಅನುಭವವನ್ನು ರೇಟ್ ಮಾಡಿ", form_enjoy_most_new: "ಆಟದಲ್ಲಿ ನೀವು ಹೆಚ್ಚು ಏನು ಆನಂದಿಸುತ್ತೀರಿ?", form_enjoy_finding_pairs: "ಹೊಂದಾಣಿಕೆಯ ಜೋಡಿಗಳನ್ನು ತ್ವರಿತವಾಗಿ ಕಂಡುಹಿಡಿಯುವುದು", form_enjoy_challenge_timer: "ಸವಾಲು/ಟೈಮರ್", form_enjoy_colors: "ವರ್ಣರಂಜಿತ ಸಂಖ್ಯೆಗಳು ಮತ್ತು ಟೈಲ್ಸ್", form_enjoy_unlocking: "ಹೊಸ ಮಟ್ಟಗಳನ್ನು ಅನ್ಲಾಕ್ ಮಾಡುವುದು", form_improve_new: "ನಾವು ಏನು ಸುಧಾರಿಸಬೇಕು?", form_improve_time: "ಹಂತಗಳಿಗೆ ಹೆಚ್ಚಿನ ಸಮಯ", form_improve_controls: "ಸುಲಭ ನಿಯಂತ್ರಣಗಳು/ಟ್ಯಾಪಿಂಗ್ ನಿಖರತೆ", form_improve_themes: "ಹೆಚ್ಚಿನ ಥೀಮ್‌ಗಳು ಅಥವಾ ಟೈಲ್ ವಿನ್ಯಾಸಗಳು", form_improve_patterns: "ಹೆಚ್ಚು ಸವಾಲಿನ ಸಂಖ್ಯೆಯ ಮಾದರಿಗಳು", form_improve_sounds: "ಶಬ್ದಗಳು ಮತ್ತು ಹಿನ್ನೆಲೆ ಸಂಗೀತ", form_comments: "ಬೇರೆ ಯಾವುದೇ ಕಾಮೆಂಟ್‌ಗಳು?", form_consent_new: "ಆಟವನ್ನು ಸುಧಾರಿಸಲು ಸಹಾಯ ಮಾಡಲು ನನ್ನ ಪ್ರತಿಕ್ರಿಯೆಯನ್ನು ಹಂಚಿಕೊಳ್ಳಲು ನಾನು ಒಪ್ಪುತ್ತೇನೆ.", submit: "ಪ್ರತಿಕ್ರಿಯೆ ಸಲ್ಲಿಸಿ", thank_you: "ಪ್ರತಿಕ್ರಿಯೆಗಾಗಿ ಧನ್ಯವಾದಗಳು!",
                    tut_title_1: "ಸಂಖ್ಯೆಗಳ ಜೋಡಿಯನ್ನು ಹುಡುಕಿ", tut_text_1: "ಒಂದೇ ರೀತಿಯ ಸಂಖ್ಯೆಗಳ ಜೋಡಿಯನ್ನು ಹುಡುಕಿ, ಅಥವಾ ಅದರ ಮೊತ್ತ 10 ಆಗಿರುವ ಸಂಖ್ಯೆಗಳನ್ನು ಟ್ಯಾಪ್ ಮಾಡಿ",
                    tut_title_2: "ಮೊತ್ತ 10", tut_text_2: "ಅಡ್ಡಲಾಗಿ, ಲಂಬವಾಗಿ, ಅಥವಾ ಕರ್ಣೀಯವಾಗಿ ಜೋಡಿಗಳನ್ನು ಇನ್ನೂ ಮಾಡಬಹುದು.",
                    tut_title_3: "ಮುಂದಿನ ಸಾಲಿನಿಂದ ಸಾಲನ್ನು ಪರಿಶೀಲಿಸಿ", tut_text_3: "ಒಂದು ಸಾಲಿನ ಅಂತ್ಯದಿಂದ ಮುಂದಿನ ಸಾಲಿನ ಆರಂಭದವರೆಗೆ ಹೊಂದಾಣಿಕೆ ಸಂಭವಿಸಬಹುದು.",
                    tut_title_4: "ವಿವಿಧ ದಿಕ್ಕುಗಳಲ್ಲಿ ಜೋಡಿಸಿ", tut_text_4: "",
                    tut_title_5: "ಕರ್ಣೀಯವಾಗಿ ಹೊಂದಿಸಿ", tut_text_5: "<b>ನಿಷ್ಕ್ರಿಯ</b> ಕೋಶಗಳಿಂದ ಬೇರ್ಪಟ್ಟ ಸಂಖ್ಯೆಯನ್ನು ಕರ್ಣೀಯವಾಗಿ ಜೋಡಿಸಬಹುದು ಅಥವಾ ಮೊತ್ತ ಮಾಡಬಹುದು",
                    tut_title_6: "ಮುಂದಿನ ಸಾಲಿನಿಂದ ಸಾಲನ್ನು ಪರಿಶೀಲಿಸಿ", tut_text_6: "ಒಂದು ಸಾಲಿನ ಅಂತ್ಯದಿಂದ ಮುಂದಿನ ಸಾಲಿನ ಆರಂಭದವರೆಗೆ ಹೊಂದಾಣಿಕೆ ಸಂಭವಿಸಬಹುದು.",
                    tut_title_7: "ಹೆಚ್ಚಿನ ಸಂಖ್ಯೆಗಳನ್ನು ಸೇರಿಸಿ", tut_text_7: "ಯಾವುದೇ ಚಲನೆಗಳು ಉಳಿದಿಲ್ಲವೇ? ಹೆಚ್ಚಿನ ಸಂಖ್ಯೆಗಳನ್ನು ಸೇರಿಸಲು '+' ಟ್ಯಾಪ್ ಮಾಡಿ!",
                    tut_title_8: "ಬೋರ್ಡ್ ತೆರವುಗೊಳಿಸಿ!", tut_text_8: "ಬೋರ್ಡ್ ತೆರವುಗೊಳಿಸಲು ಜೋಡಣೆ ನಿಯಮಗಳನ್ನು ಬಳಸಿ. ನೀವು ಸಿಲುಕಿಕೊಂಡರೆ ಸುಳಿವುಗಳನ್ನು ಬಳಸಿ!",
                    tut_add_btn_text: "+ ಬಟನ್ ಮೇಲೆ ಕ್ಲಿಕ್ ಮಾಡಿ", tut_hint_btn_text: "ಸುಳಿವು ತೆಗೆದುಕೊಳ್ಳಿ",
                    tut_complete_title: "ಅಭಿನಂದನೆಗಳು!", tut_complete_text: "ನೀವು ಮೂಲಭೂತ ವಿಷಯಗಳನ್ನು ಕಲಿತಿದ್ದೀರಿ!",
                    win_tutorial_complete: "ಟ್ಯುಟೋರಿಯಲ್ ಪೂರ್ಣ! 🎉", win_stage_cleared: "ಹಂತ ತೆರವು! 🎉",
                    cancel: "ರದ್ದುಮಾಡಿ", form_placeholder: "ಆಟವನ್ನು ಸುಧಾರಿಸಲು ನಮಗೆ ಸಹಾಯ ಮಾಡಿ", feedback: "ಪ್ರತಿಕ್ರಿಯೆ", add_numbers_blurb: "ಮುಂದುವರಿಸಲು ಸಂಖ್ಯೆಗಳನ್ನು ಸೇರಿಸಿ", hint_blurb: "ಸುಳಿವು ತೋರಿಸಿ", game_over_title: "ಚಲನೆಗಳು ಮುಗಿದಿವೆ!", try_again: "ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ", home: "ಮನೆ",
                    unlock_toast_message: "'ಸಾಲನ್ನು ಸೇರಿಸು' ಅನ್‌ಲಾಕ್ ಮಾಡಲು ಇನ್ನೂ {} ಜೋಡಿಗಳನ್ನು ತೆರವುಗೊಳಿಸಿ",
                    objective_toast: "ಬೋರ್ಡ್ ಸಂಖ್ಯೆಗಳನ್ನು ತೆರವುಗೊಳಿಸಿ",
                    get_ready: "ಸಿದ್ಧರಾಗಿ!",
                    new_game_confirm_title: "ಹೊಸ ಆಟವನ್ನು ಪ್ರಾರಂಭಿಸಬೇಕೆ?",
                    new_game_confirm_text: "ಇದು ನಿಮ್ಮ ಪ್ರಸ್ತುತ ಪ್ರಗತಿಯನ್ನು ಅಳಿಸುತ್ತದೆ ಮತ್ತು ಹಂತ 1 ರಿಂದ ಪ್ರಾರಂಭವಾಗುತ್ತದೆ. ನಿಮಗೆ ಖಚಿತವೆ?",
                    yes: "ಹೌದು",
                    no: "ಇಲ್ಲ"
                },
                ta: {
                    how_to_play_title: "டுட்டோரியல்!", lang_en: "English", lang_hi: "हिन्दी", lang_kn: "ಕನ್ನಡ", lang_ta: "தமிழ்", lang_te: "తెలుగు", lang_code_short: "த", title: "ಎண் பொருத்தம்", stage: "கட்டம்", score: "மதிப்பெண்", best: "சிறந்தது", paused: "இடைிறுத்தப்பட்டது", how_to_play: "💡 டுட்டோரியல்!", retry: "மீண்டும் முயற்சிக்கவும்", continue: "தொடரவும்", language: "மொழி", new_game: "புதிய விளையாட்டு", skip: "தவிర్", settings: "ಅமைப்புகள்", sound: "ஒலி", feedback_title: "ಎண் பொருத்தத்தை இன்னும் வேடிக்கையாக மாற்ற எங்களுக்கு உதவுங்கள்!", feedback_title_new: "ಎண் பொருத்தத்தை இன்னும் வேடிக்கையாக மாற்ற எங்களுக்கு உதவுங்கள்!", feedback_desc_new: "உங்களுக்காக நாங்கள் எப்போதும் விளையாட்டை மேம்படுத்துகிறோம்! உங்கள் எண்ணங்களைப் பகிர்ந்து 50 போனస్ நாணயங்களைப் பெறுங்கள்.", form_name: "பெயர் / புனைப்பெயர் (விருப்பத்தேர்வு)", form_email: "ಮின்னஞ்சல் (விருப்பத்தேர்வு)", form_rate_exp: "உங்கள் அனுபவத்தை மதிப்பிடுங்கள்", form_enjoy_most_new: "விளையாட்டில் நீங்கள் அதிகம் விரும்புவது எது?", form_enjoy_finding_pairs: "பொருந்தும் ஜோடிಗಳನ್ನು விரைவாகக் கண்டறிதல்", form_enjoy_challenge_timer: "ಸವಾಲು/டைமர்", form_enjoy_colors: "வண்ணமயமான எண்கள் மற்றும் ஓடுகள்", form_enjoy_unlocking: "புதிய நிலைகளைத் திறத்தல்", form_improve_new: "ನಾங்கள் என்ன மேம்படுத்த வேண்டும்?", form_improve_time: "நிலைகளுக்கு அதிக நேரம்", form_improve_controls: "எளிதான கட்டுப்பாடுகள்/தட்டுதல் துல்லியம்", form_improve_themes: "மேலும் தீம்கள் அல்லது ஓடு வடிவமைப்புகள்", form_improve_patterns: "மேலும் சவாலான எண் வடிவங்கள்", form_improve_sounds: "ಒலிகள் மற்றும் பின்னணி இசை", form_comments: "வேறு ஏதேனும் கருத்துகள்?", form_consent_new: "விளையாட்டை மேம்படுத்த உதவ எனது கருத்தைப் பகிர ஒப்புக்கொள்கிறேன்.", submit: "கருத்துக்களைச் சமர்ப்பிக்கவும்", thank_you: "கருத்துக்களுக்கு நன்றி!",
                    tut_title_1: "எண்களின் ஜோடியைக் கண்டறியவும்", tut_text_1: "ஒரே மாதிரியான எண்களின் ஜோடியைக் கண்டறியவும், அல்லது அதன் கூட்டுத்தொகை 10 ஆக இருக்கும் எண்களைத் தட்டவும்",
                    tut_title_2: "கூட்டுத்தொகை 10", tut_text_2: "கிடைமட்டமாக, செங்குத்தாக, அல்லது மூலைவிட்டமாக ஜோடிகளை இன்னும் உருவாக்கலாம்.",
                    tut_title_3: "அடுத்த வரியுடன் வரியைச் சரிபார்க்கவும்", tut_text_3: "ಒಂದು வரியின் முடிவிலிருந்து அடுத்த வரியின் தொடக்கத்திற்கு ஒரு பொருத்தம் ஏற்படலாம்.",
                    tut_title_4: "வெவ்வேறு திசைகளில் ஜோடி", tut_text_4: "",
                    tut_title_5: "மூலைவிட்டமாகப் பொருத்துங்கள்", tut_text_5: "<b>செயலற்ற</b> செல்களால் பிரிக்கப்பட்ட எண்ணை மூலைவிட்டமாக ஜோடி சேர்க்கலாம் அல்லது கூட்டலாம்",
                    tut_title_6: "அடுத்த வரியுடன் வரியைச் சரிபார்க்கவும்", tut_text_6: "ಒಂದು வரியின் முடிவிலிருந்து அடுத்த வரியின் தொடக்கத்திற்கு ஒரு பொருத்தம் ஏற்படலாம்.",
                    tut_title_7: "மேலும் எண்களைச் சேர்க்கவும்", tut_text_7: "நகர்வுகள் எதுவும் இல்லை? மேலும் எண்களைச் சேர்க்க '+' தட்டவும்!",
                    tut_title_8: "பலகையை அழிக்கவும்!", tut_text_8: "பலகையை அழிக்க ஜோடி விதிகளைப் பயன்படுத்தவும். நீங்கள் சிக்கிக்கொண்டால் குறிப்புகளைப் பயன்படுத்தவும்!",
                    tut_add_btn_text: "+ பொத்தானைக் கிளிக் செய்க", tut_hint_btn_text: "ஒரு குறிப்பு எடு",
                    tut_complete_title: "வாழ்த்துக்கள்!", tut_complete_text: "நீங்கள் அடிப்படைகளைக் கற்றுக்கொண்டீர்கள்!",
                    win_tutorial_complete: "டுட்டோரியல் முடிந்தது! 🎉", win_stage_cleared: "கட்டம் முடிந்தது! 🎉",
                    cancel: "ரத்துசெய்", form_placeholder: "விளையாட்டை மேம்படுத்த எங்களுக்கு உதவுங்கள்", feedback: "கருத்து", add_numbers_blurb: "தொடர எண்களைச் சேர்க்கவும்", hint_blurb: "ఒரு குறிப்பைக் காட்டு", game_over_title: "நகர்வுகள் இல்லை!", try_again: "மீண்டும் முயற்சிக்கவும்", home: "முகப்பு",
                    unlock_toast_message: "'Add Row' திறக்க இன்னும் {} ஜோடிகளை அழிக்கவும்",
                    objective_toast: "பலகை எண்களை அழிக்கவும்",
                    get_ready: "தயாராகுங்கள்!",
                    new_game_confirm_title: "புதிய விளையாட்டைத் தொடங்கவா?",
                    new_game_confirm_text: "இது உங்கள் தற்போதைய முன்னேற்றத்தை அழித்து, நிலை 1 முதல் தொடங்கும். உங்களுக்கு உறுதியா?",
                    yes: "ஆம்",
                    no: "இல்லை"
                },
                te: {
                    how_to_play_title: "ట్యుటోరియల్!", lang_en: "English", lang_hi: "हिन्दी", lang_kn: "ಕನ್ನಡ", lang_ta: "தமிழ்", lang_te: "తెలుగు", lang_code_short: "తె", title: "సంఖ్యల జత", stage: "దశ", score: "స్కోరు", best: "ಉత్తమ", paused: "పాజ్ చేయబడింది", how_to_play: "💡 ట్యుటోరియల్!", retry: "మళ్ళీ ప్రయత్నించండి", continue: "కొనసాగించు", language: "భాಷ", new_game: "కొత్త ఆట", skip: "దాటవేయి", settings: "సెట్టింగ్‌లు", sound: "ధ్వని", feedback_title: "సంఖ్యల జతను మరింత సరదాగా చేయడానికి మాకు సహాయం చేయండి!", feedback_title_new: "సంఖ్యల జతను మరింత సరదాగా చేయడానికి మాకు సహాయం చేయండి!", feedback_desc_new: "మేము మీ కోసం ఎల్లప్పుడూ ఆటను మెరుగుపరుస్తున్నాము! మీ ఆలోచనలను పంచుకోండి మరియు ధన్యవాదాలుగా 50 బోనస్ నాణేలను పొందండి.", form_name: "పేరు / ముద్దుపేరు (ಐచ్ఛికం)", form_email: "ఇమెయిల్ (ಐచ్ఛికం)", form_rate_exp: "మీ అనుభవాన్ని రేట్ చేయండి", form_enjoy_most_new: "ఆటలో మీరు ఎక్కువగా ఏమి ఆనందిస్తారు?", form_enjoy_finding_pairs: "సరిపోయే జతలను త్వరగా కనుగొనడం", form_enjoy_challenge_timer: "సవాలు/టైమర్", form_enjoy_colors: "రంగురంగుల సంఖ్యలు మరియు టైల్స్", form_enjoy_unlocking: "కొత్త స్థాయిలను అన్‌లాಕ್ చేయడం", form_improve_new: "మేము ఏమి మెరుగుపరచాలి?", form_improve_time: "స్థాయిలకు ఎక్కువ సమయం", form_improve_controls: "సులభమైన నియంత్రಣలు/ట్యాపింగ్ ఖచ్చితత్వం", form_improve_themes: "మరిన్ని థీమ్‌లు లేదా టైల్ డిజైన్‌లు", form_improve_patterns: "మరింత సవాలుగా ఉండే సంఖ్యల నమూనాలు", form_improve_sounds: "శబ్దాలు మరియు నేపథ్య సంగీతం", form_comments: "ఇతర వ్యాఖ్యలు ఏమైనా ఉన్నాయా?", form_consent_new: "ఆటను మెరుగుపరచడంలో సహాయపడటానికి నా అభిప్రాయాన్ని పంచుకోవడానికి నేను అంగీకరిస్తున్నాను.", submit: "అభిప్రాయాన్ని సమర్పించండి", thank_you: "అభిప్రాయానికి ధన్యవాదాలు!",
                    tut_title_1: "సంఖ్యల జతను కనుగొనండి", tut_text_1: "ఒకే రకమైన సంఖ్యల జతను కనుగొనండి, లేదా దాని మొత్తం 10 ఉన్న సంఖ్యలను నొక్కండి",
                    tut_title_2: "మొత్తం 10", tut_text_2: "అడ్డంగా, నిలువుగా, లేదా వికర్ణంగా జతలను ఇంకా చేయవచ్చు.",
                    tut_title_3: "తదుపరి లైన్‌తో లైన్‌ను తనిఖీ చేయండి", tut_text_3: "ఒక వరుச చివరి నుండి తదుపరి వరుச ప్రారంభం వరకు ఒక సరిపోలిక జరగవచ్చు.",
                    tut_title_4: "వివిధ దిశలలో జత చేయండి", tut_text_4: "",
                    tut_title_5: "వికర్ణంగా సరిపోల్చండి", tut_text_5: "<b>నిష్క్రియ</b> కణాల ద్వారా వేరు చేయబడిన సంఖ్యను వికర్ణంగా జత చేయవచ్చు లేదా మొత్తం చేయవచ్చు",
                    tut_title_6: "తదుపరి లైన్‌తో లైన్‌ను తనిఖీ చేయండి", tut_text_6: "ఒక వరుச చివరి నుండి తదుపరి వరుச ప్రారంభం వరకు ఒక సరిపోలిక జరగవచ్చు.",
                    tut_title_7: "మరిన్ని సంఖ్యలను జోడించండి", tut_text_7: "ఎటువంటి కదలికలు మిగిలి లేవా? మరిన్ని సంఖ్యలను జోడించడానికి '+' నొక్కండి!",
                    tut_title_8: "బోర్డును క్లియర్ చేయండి!", tut_text_8: "బోర్డును క్లియర్ చేయడానికి జత చేసే నియమాలను ఉపయోగించండి. మీరు చిక్కుకుపోతే సూచనలను ఉపయోగించండి!",
                    tut_add_btn_text: "+ బటన్‌పై క్లిక్ చేయండి", tut_hint_btn_text: "సూచన తీసుకోండి",
                    tut_complete_title: "అభినందనలు!", tut_complete_text: "మీరు ప్రాథమికాలను నేర్చుకున్నారు!",
                    win_tutorial_complete: "ట్యుటోరియల్ పూర్తయింది! 🎉", win_stage_cleared: "దశ పూర్తయింది! 🎉",
                    cancel: "రద్దు చేయండి", form_placeholder: "ఆటను మెరుగుపరచడంలో మాకు సహాయపడండి", feedback: "అభిప్రాయం", add_numbers_blurb: "కొనసాగించడానికి సంఖ్యలను జోడించండి", hint_blurb: "సూచనను చూపండి", game_over_title: "కదలికలు ముగిశాయి!", try_again: "మళ్ళీ ప్రయత్నించండి", home: "హోమ్",
                    unlock_toast_message: "'వరుసను జోడించు' అన్‌లాక్ చేయడానికి {} మరిన్ని మ్యాచ్‌లను క్లియర్ చేయండి",
                    objective_toast: "బోర్డు నంబర్లను క్లియర్ చేయండి",
                    get_ready: "సిద్ధంగా ఉండండి!",
                    new_game_confirm_title: "కొత్త ఆట ప్రారంభించాలా?",
                    new_game_confirm_text: "ఇది మీ ప్రస్తుత పురోగతిని చెరిపివేసి, 1వ దశ నుండి ప్రారంభమవుతుంది. మీరు ఖచ్చితంగా ఉన్నారా?",
                    yes: "అవును",
                    no: "కాదు"
                }
            };

            let currentLang = 'en';

            function setLanguage(lang) {
                currentLang = lang;
                localStorage.setItem('sumLinkLanguage', lang);
                const langCodeShort = translations[lang].lang_code_short || lang.toUpperCase();
                document.getElementById('lang-select-btn').textContent = langCodeShort;
                 const gameLangBtn = document.getElementById('game-lang-select-btn');
                if (gameLangBtn) {
                    gameLangBtn.textContent = langCodeShort;
                }
                document.querySelectorAll('[data-lang]').forEach(el => {
                    const key = el.getAttribute('data-lang');
                    if (translations[lang] && translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    } else if (translations['en'][key]) {
                        el.innerHTML = translations['en'][key];
                    }
                });
                 document.querySelectorAll('[data-lang-template]').forEach(el => {
                    const key = el.getAttribute('data-lang-template');
                    if (translations[lang] && translations[lang][key]) {
                        el.dataset.template = translations[lang][key];
                    } else if (translations['en'][key]) {
                        el.dataset.template = translations['en'][key];
                    }
                });
                document.querySelectorAll('[data-lang-prefix]').forEach(el => {
                    const key = el.getAttribute('data-lang-prefix');
                    const stageNumberMatch = el.textContent.match(/\d+/);
                    if (stageNumberMatch && translations[lang] && translations[lang][key]) {
                        const stageNumber = stageNumberMatch[0];
                        el.textContent = `${translations[lang][key]} ${stageNumber}`;
                    }
                });
                document.querySelectorAll('[data-placeholder-lang]').forEach(el => {
                    const key = el.getAttribute('data-placeholder-lang');
                     if (translations[lang] && translations[lang][key]) {
                        el.placeholder = translations[lang][key];
                    } else if (translations['en'][key]) {
                        el.placeholder = translations['en'][key];
                    }
                });
                if (!tutorialContainer.classList.contains('hidden') && tutorialStep < tutorialSequence.length) {
                    const currentStepData = tutorialSequence[tutorialStep].tutorial;
                    updateTutorialInfo(currentStepData);
                }
                document.querySelectorAll('#settings-modal .lang-btn').forEach(btn => {
                    btn.classList.remove('selected-lang');
                    if (btn.dataset.langCode === lang) {
                        btn.classList.add('selected-lang');
                    }
                });
            }

            function proceedToNextStage() {
                if (!nextStageDataForCallback) return;
                const { newStage, isFromTutorial } = nextStageDataForCallback;
                nextStageDataForCallback = null;
                winAnimation.classList.add('hidden');
                if (winAnimationId) {
                    cancelAnimationFrame(winAnimationId);
                    winAnimationId = null;
                }

                const stageText = `${translations[currentLang].stage || translations.en.stage} ${newStage}`;
                const readyText = translations[currentLang].get_ready || translations.en.get_ready;
                stageStartMessage.innerHTML = `<div class="text-2xl font-semibold mb-2">${readyText}</div><div>${stageText}</div>`;
                
                stageStartModal.classList.remove('hidden');
                setTimeout(() => {
                    stageStartModal.classList.add('hidden');
                    if (isFromTutorial) {
                        transitionToGame(newStage);
                    } else {
                        initGame(newStage);
                    }
                }, 500);
            }
            
            const confettiParticles = [];
            const winConfettiParticles = [];
            let animationFrameId = null;
            let winAnimationId = null;
            
            class ConfettiParticle {
                constructor(x, y, ctx) {
                    this.x = x;
                    this.y = y;
                    this.ctx = ctx;
                    this.size = Math.random() * 8 + 4;
                    this.angle = Math.random() * Math.PI * 2;
                    this.speed = Math.random() * 4 + 2;
                    this.vx = Math.cos(this.angle) * this.speed;
                    this.vy = Math.sin(this.angle) * this.speed;
                    this.gravity = 0.1;
                    this.opacity = 1;
                    this.rotation = Math.random() * 360;
                    this.rotationSpeed = Math.random() * 20 - 10;
                    this.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += this.gravity;
                    this.opacity -= 0.01;
                    this.rotation += this.rotationSpeed;
                }

                draw() {
                    this.ctx.save();
                    this.ctx.globalAlpha = this.opacity;
                    this.ctx.translate(this.x, this.y);
                    this.ctx.rotate(this.rotation * Math.PI / 180);
                    this.ctx.fillStyle = this.color;
                    this.ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
                    this.ctx.restore();
                }
            }
            
            function animateConfetti() {
                const effectCanvas = document.getElementById('effect-canvas');
                const ctx = effectCanvas.getContext('2d');
                effectCanvas.width = appWrapper.clientWidth;
                effectCanvas.height = appWrapper.clientHeight;
                ctx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
                for (let i = confettiParticles.length - 1; i >= 0; i--) {
                    const p = confettiParticles[i];
                    p.update();
                    p.draw();
                    if (p.opacity <= 0) {
                        confettiParticles.splice(i, 1);
                    }
                }
                if (confettiParticles.length > 0) {
                    animationFrameId = requestAnimationFrame(animateConfetti);
                } else {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                    ctx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
                }
            }

            function animateWinConfetti() {
                const winCanvas = document.getElementById('win-canvas');
                const ctx = winCanvas.getContext('2d');
                winCanvas.width = appWrapper.clientWidth;
                winCanvas.height = appWrapper.clientHeight;
                ctx.clearRect(0, 0, winCanvas.width, winCanvas.height);
                 if (Math.random() > 0.5) { 
                     winConfettiParticles.push(new ConfettiParticle(Math.random() * winCanvas.width, -20, ctx));
                 }
                for (let i = winConfettiParticles.length - 1; i >= 0; i--) {
                    const p = winConfettiParticles[i];
                    p.update();
                    p.draw();
                    if (p.y > winCanvas.height) {
                        winConfettiParticles.splice(i, 1);
                    }
                }
                winAnimationId = requestAnimationFrame(animateWinConfetti);
            }

            const appWrapper = document.getElementById('app-wrapper');
            const homeScreen = document.getElementById('home-screen');
            const newGameBtn = document.getElementById('new-game-btn');
            const continueGameBtn = document.getElementById('continue-game-btn');
            const homeSettingsBtn = document.getElementById('home-settings-btn');
            const homeBestScoreValue = document.getElementById('home-best-score-value');
            const languageSelectionScreen = document.getElementById('language-selection-screen');
            const tutorialContainer = document.getElementById('tutorial-container');
            const tutorialGrid = tutorialContainer.querySelector('.game-grid-container');
            const tutorialTitle = document.getElementById('tutorial-title');
            const tutorialInfoBox = document.getElementById('tutorial-info-box');
            const tutorialText = document.getElementById('tutorial-text');
            const tutorialProgress = document.getElementById('tutorial-progress');
            const tutorialControlsFooter = document.getElementById('tutorial-controls-footer');
            const addNumbersSectionTutorial = document.getElementById('add-numbers-section-tutorial');
            const addBtnTutorial = document.getElementById('add-btn-tutorial');
            const addBtnTutorialBlurb = document.getElementById('add-btn-tutorial-blurb');
            const hintSectionTutorial = document.getElementById('hint-section-tutorial');
            const tutorialHintBtn = document.getElementById('tutorial-hint-btn');
            const hintBtnTutorialBlurb = document.getElementById('hint-btn-tutorial-blurb');
            const handIcon = document.getElementById('hand-icon');
            const tutorialTextContainer = document.getElementById('tutorial-text-container');
            const tutorialSpotlight = document.getElementById('tutorial-spotlight');
            const tutorialArrow = document.getElementById('tutorial-arrow');
            const feedbackModal = document.getElementById('feedback-modal');
            const closeFeedbackModalBtn = document.getElementById('close-feedback-modal');
            const feedbackForm = document.getElementById('feedback-form');
            const thankYouModal = document.getElementById('thank-you-modal');
            const closeThankYouModalBtn = document.getElementById('close-thank-you-modal');
            const thankYouThumb = document.getElementById('thank-you-thumb');
            const stageStartModal = document.getElementById('stage-start-modal');
            const stageStartMessage = document.getElementById('stage-start-message');
            const cancelFeedbackBtn = document.getElementById('cancel-feedback-btn');
            const winCanvas = document.getElementById('win-canvas');
            const gameOverModal = document.getElementById('game-over-modal');
            const closeGameOverModalBtn = document.getElementById('close-game-over-modal');
            const tryAgainBtn = document.getElementById('try-again-btn');
            const gameOverHomeBtn = document.getElementById('game-over-home-btn');
            const unlockToast = document.getElementById('unlock-toast');
            const slideInToast = document.getElementById('slide-in-toast');
            const langSelectBtn = document.getElementById('lang-select-btn');
            const langDropdownContent = document.getElementById('lang-dropdown-content');
            const gameLangSelectBtn = document.getElementById('game-lang-select-btn');
            const gameLangDropdownContent = gameLangSelectBtn.nextElementSibling;
            const tutorialEquation = document.getElementById('tutorial-equation');

            let tutorialBoard = [];
            let tutorialStep = 0;
            let tutorialFirstCell = null;
            let gridHandAnimationInterval = null;
            let buttonHandAnimationInterval = null;
            let tutorialHintedPair = null; 
            let tutorialPlayable = false;
            let spotlightTimer = null;

            const tutorialSequence = [
                { highlight: [2, 7], tutorial: { titleKey: "tut_title_1", textKey: "tut_text_1", progress: "1/4" } },
                { highlight: [8, 6], tutorial: { titleKey: "tut_title_2", textKey: "tut_text_2", progress: "2/4" } },
                { highlight: [3, 11], tutorial: { titleKey: "tut_title_5", textKey: "tut_text_5", progress: "3/4" } },
                { highlight: [4, 5], tutorial: { titleKey: "tut_title_3", textKey: "tut_text_3", progress: "4/4" } },
                { action: 'prompt_add', tutorial: { titleKey: "tut_title_7", textKey: "tut_text_7", progress: "" } },
                { action: 'add_numbers', tutorial: { titleKey: "tut_title_8", textKey: "tut_text_8", progress: "" } },
                { action: 'complete', tutorial: { titleKey: "tut_complete_title", textKey: "tut_complete_text", progress: "" } }
            ];
            
            function initTutorial(isFromPauseMenu = false) {
                const initialValues = [1, 9, 5, 6, 8, 2, 3, 5, 7, 2, 3, 4, 6, 9, 1];
                const inactiveIndices = [0, 1, 9, 14];
                tutorialBoard = initialValues.map((val, i) => ({ 
                    value: val, 
                    state: inactiveIndices.includes(i) ? 'blurred' : 'active' 
                }));
                tutorialStep = 0;
                tutorialPlayable = false;
                renderTutorialBoard();
                tutorialControlsFooter.classList.add('hidden');
                hideHandIcon();
                tutorialEquation.classList.add('hidden');

                if (isFromPauseMenu) {
                    runTutorialStep();
                } else {
                    setTimeout(() => {
                        runTutorialStep();
                    }, 1000);
                }
            }

            function renderTutorialBoard() {
                tutorialGrid.innerHTML = '';
                tutorialBoard.forEach((cellData) => {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell', 'flex', 'items-center', 'justify-center');
                    const numberText = document.createElement('span');
                    numberText.classList.add('number-text');
                    numberText.textContent = cellData.value;
                    cell.appendChild(numberText);
                    if (cellData.state === 'blurred') cell.classList.add('blurred');
                    else if (cellData.state === 'cleared') cell.classList.add('cleared');
                    tutorialGrid.appendChild(cell);
                });
            }
            
            function runTutorialStep() {
                if (tutorialStep >= tutorialSequence.length) return;
                const step = tutorialSequence[tutorialStep];
                updateTutorialInfo(step.tutorial);
                
                if (tutorialStep === 0) {
                    tutorialEquation.textContent = "5 = 5";
                    tutorialEquation.classList.remove('hidden');
                    tutorialEquation.classList.add('highlight-equation');
                } else if (tutorialStep === 1) {
                    tutorialEquation.textContent = "3 + 7 = 10";
                    tutorialEquation.classList.remove('hidden');
                    tutorialEquation.classList.add('highlight-equation');
                } else {
                    tutorialEquation.classList.add('hidden');
                    tutorialEquation.classList.remove('highlight-equation');
                }

                if (step.highlight) {
                    startInteractiveTutorialStep(step.highlight[0], step.highlight[1]);
                } else if (step.action) {
                    handleTutorialAction(step.action);
                }
            }

            function handleTutorialAction(action) {
                if (action === 'prompt_add') {
                    const newBoardContent = [];
                    for (let i = 0; i < tutorialBoard.length; i += 5) {
                        const row = tutorialBoard.slice(i, i + 5);
                        if (!row.every(cell => cell.state === 'blurred' || cell.state === 'cleared')) {
                            newBoardContent.push(...row);
                        }
                    }
                    const compactedBoard = Array(15).fill({value: null, state: 'cleared'});
                    newBoardContent.forEach((cell, i) => {
                       compactedBoard[i] = cell;
                    });
                    tutorialBoard = compactedBoard;
                    renderTutorialBoard();
                    tutorialControlsFooter.classList.remove('hidden');
                    addNumbersSectionTutorial.classList.remove('hidden');
                    hintSectionTutorial.classList.add('hidden');
                    
                    // Show the initial prompt text
                    tutorialTextContainer.classList.remove('hidden'); 
                    pointHandToButton(addBtnTutorial, 'above', '👇');


                    // Start timer to show spotlight if idle
                    spotlightTimer = setTimeout(() => {
                        hideHandIcon();
                        showSpotlightOn(addBtnTutorial, true);
                    }, 5000);

                    tutorialStep++;
                    addBtnTutorial.onclick = () => {
                        clearTimeout(spotlightTimer);
                        hideSpotlight();
                        hideHandIcon();
                        playSound('click');
                        addBtnTutorial.disabled = true;

                        setTimeout(() => {
                            runTutorialStep();
                        }, 200);
                    };
                } else if (action === 'add_numbers') {
                    addNumbersSectionTutorial.classList.add('hidden');
                    hintSectionTutorial.classList.remove('hidden');
                    hintBtnTutorialBlurb.classList.remove('hidden');
                    const newNumbers = [9, 3, 6];
                    let lastNumberIndex = -1;
                    for(let i = tutorialBoard.length - 1; i >= 0; i--) {
                        if (tutorialBoard[i].state !== 'cleared') {
                            lastNumberIndex = i;
                            break;
                        }
                    }
                    let insertIndex = lastNumberIndex + 1;
                    newNumbers.forEach(num => {
                        if(insertIndex < tutorialBoard.length) {
                           tutorialBoard[insertIndex] = { value: num, state: 'active' };
                           insertIndex++;
                        }
                    });
                    renderTutorialBoard();
                    
                    // Keep grid unplayable until animations are set
                    tutorialPlayable = false; 

                    // Start timer to show spotlight if idle
                    spotlightTimer = setTimeout(() => {
                        showSpotlightOn(tutorialHintBtn, false);
                    }, 5000);
                    
                    setTimeout(() => {
                        tutorialPlayable = true;
                        attachTutorialClickListeners();
                    }, 500);

                    tutorialHintBtn.onclick = () => {
                        clearTimeout(spotlightTimer);
                        hideSpotlight();
                        const pair = findValidPair(tutorialBoard, 5);
                        if(pair) {
                            const [idx1, idx2] = pair;
                            const cell1 = tutorialGrid.children[idx1];
                            const cell2 = tutorialGrid.children[idx2];
                            cell1.classList.add('hint-highlight');
                            cell2.classList.add('hint-highlight');
                            setTimeout(() => {
                                cell1.classList.remove('hint-highlight');
                                cell2.classList.remove('hint-highlight');
                            }, 1000);
                        }
                    };
                    tutorialStep++;
                } else if (action === 'complete') {
                    if (tutorialBoard.every(c => c.state !== 'active')) {
                        tutorialControlsFooter.classList.add('hidden');
                        updateTutorialInfo({ titleKey: "tut_complete_title", textKey: "tut_complete_text", progress: "" });
                        localStorage.setItem('sumLinkTutorialCompleted', 'true');
                        trackEvent('tutorial_completed');
                        startNextStageTransition(1, true);
                    }
                }
            }
            
            function attachTutorialClickListeners() {
                tutorialBoard.forEach((cellData, index) => {
                    const cellEl = tutorialGrid.children[index];
                    if (cellData.state === 'active') {
                        cellEl.onclick = () => handleTutorialPlayableClick(index);
                    } else {
                        cellEl.onclick = null;
                    }
                });
            }

            function handleTutorialPlayableClick(index) {
                if (!tutorialPlayable) return;
                hideHandIcon();

                 if (tutorialFirstCell === null) {
                     tutorialFirstCell = index;
                     tutorialGrid.children[index].classList.add('selected');
                 } else {
                     if (tutorialFirstCell === index) { 
                         tutorialGrid.children[index].classList.remove('selected');
                         tutorialFirstCell = null;
                         return;
                     }

                     const matchResult = isValidPair(tutorialBoard, tutorialFirstCell, index, 5);
                     if (matchResult.valid) {
                         tutorialGrid.children[index].classList.add('selected');
                         playMatchAnimation(tutorialGrid, tutorialFirstCell, index, () => {
                             playSound('normal');
                             
                             const num1 = tutorialBoard[tutorialFirstCell].value;
                             const num2 = tutorialBoard[index].value;
                             trackEvent('tutorial_match_made', {
                                 tutorial_step: tutorialStep,
                                 numbers: `${num1},${num2}`,
                                 match_type: num1 === num2 ? 'same_number' : 'sum_to_10'
                             });

                             tutorialBoard[tutorialFirstCell].state = 'blurred';
                             tutorialBoard[index].state = 'blurred';
                             tutorialFirstCell = null;
                             renderTutorialBoard();
                             attachTutorialClickListeners();
                             if (tutorialBoard.every(c => c.state !== 'active')) {
                                 runTutorialStep();
                             }
                         }, matchResult.type);
                     } else {
                         playSound('error');
                         
                         const num1 = tutorialBoard[tutorialFirstCell].value;
                         const num2 = tutorialBoard[index].value;
                         trackEvent('tutorial_match_failed', {
                             tutorial_step: tutorialStep,
                             numbers: `${num1},${num2}`
                         });

                         const cell1 = tutorialGrid.children[tutorialFirstCell];
                         const cell2 = tutorialGrid.children[index];
                         cell1.classList.add('shake');
                         cell2.classList.add('shake');
                         setTimeout(() => {
                             cell1.classList.remove('shake', 'selected');
                             cell2.classList.remove('shake');
                         }, 820);
                         tutorialFirstCell = null;
                     }
                 }
            }

            function startInteractiveTutorialStep(idx1, idx2) {
                const cell1 = tutorialGrid.children[idx1];
                const cell2 = tutorialGrid.children[idx2];
                cell1.classList.add('tutorial-initial-highlight');
                cell2.classList.add('tutorial-initial-highlight');
                
                const pointToCell = (index) => {
                    const cell = tutorialGrid.children[index];
                    if (!cell) return;
                    const rect = cell.getBoundingClientRect();
                    const appRect = appWrapper.getBoundingClientRect();
                    handIcon.style.top = `${rect.bottom - appRect.top - 45}px`;
                    handIcon.style.left = `${rect.left - appRect.left + (rect.width / 2) - 20}px`;
                    handIcon.textContent = '👆';
                };
                
                let currentTargetIndex = 0;
                const targets = [idx1, idx2];

                const tapSequence = () => {
                    const targetCellIndex = targets[currentTargetIndex];
                    pointToCell(targetCellIndex);
                    handIcon.classList.remove('hidden');
                    handIcon.classList.add('tapping');
                    handIcon.addEventListener('animationend', () => {
                        handIcon.classList.remove('tapping');
                        handIcon.classList.add('hidden');
                        currentTargetIndex = (currentTargetIndex + 1) % targets.length;
                    }, { once: true });
                };

                gridHandAnimationInterval = setInterval(tapSequence, 1000);
                tapSequence();

                const handleFirstClick = (clickedIndex, otherIndex) => {
                    clearInterval(gridHandAnimationInterval);
                    gridHandAnimationInterval = null;
                    tutorialFirstCell = clickedIndex;
                    tutorialGrid.children[clickedIndex].classList.remove('tutorial-initial-highlight');
                    tutorialGrid.children[clickedIndex].classList.add('selected');
                    cell1.onclick = null;
                    cell2.onclick = null;

                    const tapSecondCell = () => {
                        pointToCell(otherIndex);
                        handIcon.classList.remove('hidden');
                        handIcon.classList.add('tapping');
                        handIcon.addEventListener('animationend', () => {
                            handIcon.classList.remove('tapping');
                            handIcon.classList.add('hidden');
                        }, { once: true });
                    };
                    gridHandAnimationInterval = setInterval(tapSecondCell, 1000);
                    tapSecondCell();
                    tutorialGrid.children[otherIndex].onclick = () => handleSecondClick(otherIndex);
                };

                const handleSecondClick = (clickedIndex) => {
                    hideHandIcon();
                    tutorialGrid.children[clickedIndex].classList.remove('tutorial-initial-highlight');
                    tutorialGrid.children[clickedIndex].classList.add('selected');
                    const matchResult = isValidPair(tutorialBoard, tutorialFirstCell, clickedIndex, 5);
                    playMatchAnimation(tutorialGrid, tutorialFirstCell, clickedIndex, () => {
                        playSound('normal');

                        const num1 = tutorialBoard[tutorialFirstCell].value;
                        const num2 = tutorialBoard[clickedIndex].value;
                        trackEvent('tutorial_match_made', {
                            tutorial_step: tutorialStep + 1,
                            numbers: `${num1},${num2}`,
                            match_type: num1 === num2 ? 'same_number' : 'sum_to_10'
                        });

                        tutorialBoard[tutorialFirstCell].state = 'blurred';
                        tutorialBoard[clickedIndex].state = 'blurred';
                        tutorialFirstCell = null;
                        renderTutorialBoard();
                        trackEvent('tutorial_step', { step_number: tutorialStep + 1 });
                        tutorialStep++;
                        setTimeout(runTutorialStep, 500);
                    }, matchResult.type);
                };

                cell1.onclick = () => handleFirstClick(idx1, idx2);
                cell2.onclick = () => handleFirstClick(idx2, idx1);
            }

            function showSpotlightOn(element, showMessageBox) {
                // Hide the normal tutorial text and initial hand icon
                document.getElementById('tutorial-main-content').style.visibility = 'hidden';
                hideHandIcon();
                
                tutorialSpotlight.classList.remove('hidden');
                tutorialSpotlight.classList.add('flex');

                const messageText = document.getElementById('spotlight-message-text');

                if (showMessageBox) {
                    messageText.textContent = "Click on the + icon button to add more numbers";
                } else {
                     messageText.textContent = "Click the 💡 to get a hint!";
                }
                
                // Bring the controls to the front
                tutorialControlsFooter.style.position = 'relative';
                tutorialControlsFooter.style.zIndex = '60';
                
                // Start the button glow animation
                element.style.animation = 'pulse-glow 2s infinite ease-in-out';
                
                const rect = element.getBoundingClientRect();
                const appRect = appWrapper.getBoundingClientRect();
                
                // Position the arrow ABOVE the button
                tutorialArrow.style.left = `${rect.left - appRect.left + (rect.width / 2) - 20}px`;
                tutorialArrow.style.top = `${rect.top - appRect.top - 80}px`;
                tutorialArrow.classList.remove('hidden');


                // Show a dimmed grid in the background for context
                const dimmedGrid = tutorialSpotlight.querySelector('.game-grid-container-dimmed');
                dimmedGrid.innerHTML = tutorialGrid.innerHTML;
            }

            function hideSpotlight() {
                if (spotlightTimer) {
                    clearTimeout(spotlightTimer);
                    spotlightTimer = null;
                }
                // Hide the spotlight and show the main content again
                tutorialSpotlight.classList.add('hidden');
                tutorialSpotlight.classList.remove('flex');
                document.getElementById('tutorial-main-content').style.visibility = 'visible';
                tutorialArrow.classList.add('hidden');
                
                // Reset styles
                tutorialControlsFooter.style.zIndex = 'auto';
                addBtnTutorial.style.animation = '';
                tutorialHintBtn.style.animation = '';
            }

            function pointHandToButton(buttonElement, position = 'top', icon = '👆') {
                hideHandIcon(); 
                handIcon.textContent = icon;
                const point = () => {
                    if (!buttonElement) return;
                    const rect = buttonElement.getBoundingClientRect();
                    const appRect = appWrapper.getBoundingClientRect();

                    // Always center horizontally
                    handIcon.style.left = `${rect.left - appRect.left + (rect.width / 2) - 20}px`;

                    if (position === 'above') {
                        // Position icon ABOVE the button
                        handIcon.style.top = `${rect.top - appRect.top - 50}px`; // 50px = approx icon height + margin
                    } else if (position === 'bottom') {
                        // Position icon BELOW the button
                        handIcon.style.top = `${rect.bottom - appRect.top}px`;
                    } else { // original 'left-of' logic, keep for other potential uses
                         handIcon.style.top = `${rect.top - appRect.top + (rect.height / 2) - 20}px`;
                         handIcon.style.left = `${rect.left - appRect.left - 40}px`;
                    }
                    
                    handIcon.classList.remove('hidden');
                    handIcon.classList.add('tapping');
                    handIcon.addEventListener('animationend', () => {
                        handIcon.classList.remove('tapping');
                    }, { once: true });
                };
                buttonHandAnimationInterval = setInterval(point, 1200);
                point();
            }

            function hideHandIcon() {
                if(gridHandAnimationInterval) clearInterval(gridHandAnimationInterval);
                if(buttonHandAnimationInterval) clearInterval(buttonHandAnimationInterval);
                gridHandAnimationInterval = null;
                buttonHandAnimationInterval = null;
                handIcon.classList.add('hidden');
            }
            
            function updateTutorialInfo({ titleKey, textKey, progress }) {
                tutorialTitle.textContent = translations[currentLang][titleKey] || translations['en'][titleKey];
                tutorialText.innerHTML = translations[currentLang][textKey] || translations['en'][textKey];
                tutorialProgress.textContent = progress;
            }

            function transitionToGame(newStage) {
                tutorialContainer.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                initGame(newStage);
            }

            function findValidPair(board, cols) {
                const activeCells = [];
                board.forEach((cell, i) => { if(cell.state === 'active') activeCells.push(i); });
                for(let i=0; i<activeCells.length; i++) {
                    for(let j=i+1; j<activeCells.length; j++) {
                        if(isValidPair(board, activeCells[i], activeCells[j], cols).valid) {
                            return [activeCells[i], activeCells[j]];
                        }
                    }
                }
                return null;
            }
            
            function findAllValidPairs(board, cols) {
                const activeCells = [];
                board.forEach((cell, i) => { if (cell.state === 'active') activeCells.push(i); });
                const validPairs = [];
                for (let i = 0; i < activeCells.length; i++) {
                    for (let j = i + 1; j < activeCells.length; j++) {
                        if (isValidPair(board, activeCells[i], activeCells[j], cols).valid) {
                            validPairs.push([activeCells[i], activeCells[j]]);
                        }
                    }
                }
                return validPairs;
            }

            function isValidPair(board, index1, index2, cols) {
                const num1 = board[index1].value;
                const num2 = board[index2].value;
                if (num1 !== num2 && num1 + num2 !== 10) return { valid: false, blocking: [] };

                const r1 = Math.floor(index1 / cols), c1 = index1 % cols;
                const r2 = Math.floor(index2 / cols), c2 = index2 % cols;
                const blocking = [];

                if (r1 === r2) {
                    for (let c = Math.min(c1, c2) + 1; c < Math.max(c1, c2); c++) {
                        if (board[r1 * cols + c].state === 'active') blocking.push(r1 * cols + c);
                    }
                    if (blocking.length > 0) return { valid: false, blocking: blocking };
                    return { valid: true, type: 'horizontal', blocking: [] };
                }

                if (c1 === c2) {
                    for (let r = Math.min(r1, r2) + 1; r < Math.max(r1, r2); r++) {
                        if (board[r * cols + c1].state === 'active') blocking.push(r * cols + c1);
                    }
                    if (blocking.length > 0) return { valid: false, blocking: blocking };
                    return { valid: true, type: 'vertical', blocking: [] };
                }
                
                if (Math.abs(r1 - r2) === Math.abs(c1 - c2)) {
                    const rStep = r1 < r2 ? 1 : -1;
                    const cStep = c1 < c2 ? 1 : -1;
                    let currR = r1 + rStep;
                    let currC = c1 + cStep;
                    while (currR !== r2) {
                        if (board[currR * cols + currC].state === 'active') blocking.push(currR * cols + currC);
                        currR += rStep;
                        currC += cStep;
                    }
                    if (blocking.length > 0) return { valid: false, blocking: blocking };
                    return { valid: true, type: 'diagonal', blocking: [] };
                }
                
                const activeIndices = [];
                board.forEach((cell, i) => { if(cell.state === 'active') activeIndices.push(i); });
                const pos1 = activeIndices.indexOf(index1);
                const pos2 = activeIndices.indexOf(index2);
                if (Math.abs(pos1 - pos2) > 0) {
                     for (let i = Math.min(pos1, pos2) + 1; i < Math.max(pos1, pos2); i++) {
                        blocking.push(activeIndices[i]);
                    }
                    if (blocking.length > 0) return { valid: false, blocking: blocking };
                }
                if (Math.abs(pos1 - pos2) === 1) return { valid: true, type: 'sequential', blocking: [] };

                return { valid: false, blocking: [] };
            }
            const gameContainer = document.getElementById('game-container');
            const mainGameGrid = document.getElementById('main-game-grid');
            const mainGameGridWrapper = document.getElementById('main-game-grid-wrapper');
            const currentScoreEl = document.getElementById('current-score');
            const bestScoreEl = document.getElementById('best-score');
            const addRowBtn = document.getElementById('add-row-btn');
            const hintBtn = document.getElementById('hint-btn');
            const hintBadge = document.getElementById('hint-badge');
            const whatsappShareBtn = document.getElementById('whatsapp-share-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const pauseModal = document.getElementById('pause-modal');
            const closePauseModalBtn = document.getElementById('close-pause-modal');
            const soundToggleBtn = document.getElementById('sound-toggle-btn');
            const howToPlayBtn = document.getElementById('how-to-play-btn');
            const retryBtn = document.getElementById('retry-btn');
            const continueBtn = document.getElementById('continue-btn');
            const addRowBadge = document.getElementById('add-row-badge');
            const stageTitle = document.getElementById('stage-title');
            const winAnimation = document.getElementById('win-animation');
            const winMessage = document.getElementById('win-message');
            const effectCanvas = document.getElementById('effect-canvas');
            const backBtn = document.getElementById('back-btn');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsModalBtn = document.getElementById('close-settings-modal');
            const feedbackBtn = document.getElementById('feedback-btn');
            const hintBlurb = document.getElementById('hint-blurb');
            const addRowBlurb = document.getElementById('add-row-blurb');

            const GAME_COLS = 9;
            let gameBoard = [];
            let score = 0;
            let bestScore = localStorage.getItem('sumLinkBestScore') || 0;
            let selectedGameCellIndex = null;
            let addRowCount = 5;
            let hintCount = 3;
            let stage = 1;
            let isStageCompleting = false;
            let inactiveTimer = null;
            let blurbCycleTimers = [];
            let hintedPair = null; 
            let isHintSingleUseCooldown = false;
            let hintReplenishCooldownInterval = null;
            const HINT_SINGLE_USE_COOLDOWN_SECONDS = 10;
            const HINT_REPLENISH_SECONDS = 50;
            let nextStageAfterWin = 1;
            let isContinuingFromTutorial = false;
            let lastMatchTime = 0;
            let comboTimer = null;
            const COMBO_TIME_LIMIT = 3000;
            let COMBO_SCORE_MULTIPLIER = 5;
            let hasShownLowMatchesToast = false;
            
            function initGame(startStage = 1) {
                if (hintReplenishCooldownInterval) {
                    clearInterval(hintReplenishCooldownInterval);
                    hintReplenishCooldownInterval = null;
                }
                hintBtn.innerHTML = '💡';
                hintBtn.style.fontSize = '2.5rem';
                hintBtn.style.backgroundImage = '';
                hintBtn.style.backgroundColor = ''; // Reset background color
                hintBadge.style.display = 'flex';

                stage = startStage;

                if (stage === 1) {
                    setTimeout(() => {
                        const objectiveToast = document.getElementById('unlock-toast');
                        objectiveToast.textContent = translations[currentLang].objective_toast || translations['en'].objective_toast;
                        objectiveToast.classList.remove('hidden');
                        objectiveToast.style.opacity = 1;
                        const objectiveToastTimeout = setTimeout(() => {
                            if (!objectiveToast.classList.contains('hidden')) {
                                objectiveToast.style.opacity = 0;
                                setTimeout(() => objectiveToast.classList.add('hidden'), 500);
                            }
                        }, 3000);
                        objectiveToast.dataset.timeoutId = objectiveToastTimeout;
                    }, 500);
                }

                if (startStage === 1) {
                    score = 0;
                }
                if (stage >= 5) {
                    hintCount = 5;
                } else {
                    hintCount = 3;
                }
                trackEvent('level_start', { level_number: stage });
                isStageCompleting = false;
                addRowCount = 5;
                hasShownLowMatchesToast = false;
                stageTitle.textContent = `Stage ${stage}`;
                setLanguage(currentLang);
                addRowBadge.textContent = addRowCount;
                hintBadge.textContent = hintCount;
                hintBtn.disabled = hintCount <= 0;
                bestScoreEl.textContent = bestScore;
                gameBoard = generateGridForStage(stage);
                renderMainGameBoard();
                addCellClickListeners();
                checkEndGameStatus();
                resetCombo();
                startInactiveTimers();
            }
            
            function generateGridForStage(stage) {
                let board = Array(GAME_COLS * 12).fill(null).map(() => ({ value: null, state: 'cleared' }));
                let initialNumbers;
                if (stage === 1) {
                    const stage1Layout = [
                        { value: 3, state: 'active' },   
                        { value: 4, state: 'active' },   
                        { value: 5, state: 'blurred' },  
                        { value: 5, state: 'blurred' },  
                        { value: 6, state: 'blurred' },  
                        { value: 4, state: 'blurred' },  
                        { value: 4, state: 'active' },   
                        { value: 7, state: 'active' }    
                    ];
                    stage1Layout.forEach((cellData, i) => {
                        board[i] = cellData;
                    });
                    return board;
                }

                if (stage === 2) {
                    initialNumbers = [
                        1, 2, 1, 9, 8, 9, 3, 4, 5,
                        3, 4, 8, 7, 2, 7, 6, 5, 6,
                        7, 6, 2, 3, 4, 8, 1, 9, 5,
                        7, 8, 1, 9, 6, 2, 3, 4, 5
                    ];
                } else {
                    let pairs = [];
                    for(let k=0; k<4; k++) {
                        for(let i=1; i<=9; i++) pairs.push(i,i);
                        for(let i=1; i<=9; i++) pairs.push(i, 10-i);
                    }
                    for (let i = pairs.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [pairs[i], pairs[j]] = [pairs[j], pairs[i]];
                    }
                    initialNumbers = pairs.slice(0, 36);
                }
                
                initialNumbers.forEach((num, i) => {
                    board[i] = { value: num, state: 'active' };
                });
                return board;
            }

            function renderMainGameBoard() {
                mainGameGrid.innerHTML = '';
                gameBoard.forEach((cellData) => {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell', 'flex', 'items-center', 'justify-center');
                    const numberText = document.createElement('span');
                    numberText.classList.add('number-text');
                    numberText.textContent = cellData.value;
                    cell.appendChild(numberText);

                     if (cellData.state === 'active') {
                    } else if (cellData.state === 'blurred') {
                         cell.classList.add('blurred');
                    } else {
                         cell.classList.add('cleared');
                         numberText.textContent = '';
                    }
                    mainGameGrid.appendChild(cell);
                });
                updateScore();
            }

            function addCellClickListeners() {
                const cells = mainGameGrid.children;
                for(let i=0; i<cells.length; i++) {
                    cells[i].onclick = () => handleGameCellClick(i);
                }
            }
            
            function showIncorrectPairEffect(index1, index2, blockingIndices) {
                const cell1 = mainGameGrid.children[index1];
                const cell2 = mainGameGrid.children[index2];

                if (!cell1 || !cell2) return;

                const addCrossMark = (cell) => {
                    const cross = document.createElement('span');
                    cross.textContent = '✖';
                    cross.style.position = 'absolute';
                    cross.style.color = '#ef4444';
                    cross.style.fontSize = '1.5rem';
                    cross.style.lineHeight = '1';
                    cross.style.fontWeight = 'bold';
                    cross.style.zIndex = '1';
                    cross.style.pointerEvents = 'none';
                    
                    cross.animate([
                        { opacity: 0, transform: 'scale(0.5)' },
                        { opacity: 1, transform: 'scale(1.2)' },
                        { opacity: 1, transform: 'scale(1)' },
                        { opacity: 0, transform: 'scale(0.5)' }
                    ], {
                        duration: 820,
                        easing: 'ease-in-out'
                    });
                    
                    cell.appendChild(cross);
                    setTimeout(() => {
                        if (cell.contains(cross)) {
                            cell.removeChild(cross);
                        }
                    }, 820);
                };

                addCrossMark(cell1);
                addCrossMark(cell2);

                if (blockingIndices && blockingIndices.length > 0) {
                    blockingIndices.forEach(idx => {
                        const blockingCell = mainGameGrid.children[idx];
                        if (blockingCell) {
                            blockingCell.classList.add('shake');
                            setTimeout(() => blockingCell.classList.remove('shake'), 820);
                        }
                    });
                } else {
                    cell1.classList.add('shake');
                    cell2.classList.add('shake');
                    setTimeout(() => {
                        cell1.classList.remove('shake');
                        cell2.classList.remove('shake');
                    }, 820);
                }
            }

            function handleGameCellClick(index) {
                const objectiveToast = document.getElementById('unlock-toast');
                if (!objectiveToast.classList.contains('hidden')) {
                    objectiveToast.style.opacity = 0;
                    setTimeout(() => objectiveToast.classList.add('hidden'), 500);
                    clearTimeout(objectiveToast.dataset.timeoutId);
                }

                clearAllBlurbTimers();
                startInactiveTimers();
                
                if (hintedPair && !hintedPair.includes(index)) {
                    if (mainGameGrid.children[hintedPair[0]]) mainGameGrid.children[hintedPair[0]].classList.remove('hint-highlight');
                    if (mainGameGrid.children[hintedPair[1]]) mainGameGrid.children[hintedPair[1]].classList.remove('hint-highlight');
                    hintedPair = null;
                }

                if (gameBoard[index].state !== 'active') return;
                const cell = mainGameGrid.children[index];

                if (selectedGameCellIndex === null) {
                    selectedGameCellIndex = index;
                    cell.classList.remove('hint-highlight');
                    cell.classList.add('selected');
                } else {
                    if (selectedGameCellIndex === index) {
                        selectedGameCellIndex = null;
                        cell.classList.remove('selected');
                        return;
                    }

                    const matchResult = isValidPair(gameBoard, selectedGameCellIndex, index, GAME_COLS);
                    if (matchResult.valid) {
                        const firstCellIndex = selectedGameCellIndex;
                        const secondCellIndex = index;
                        mainGameGrid.children[firstCellIndex].classList.remove('hint-highlight');
                        mainGameGrid.children[secondCellIndex].classList.remove('hint-highlight');
                        mainGameGrid.children[firstCellIndex].classList.add('selected');
                        mainGameGrid.children[secondCellIndex].classList.add('selected');
                        playMatchAnimation(mainGameGrid, firstCellIndex, secondCellIndex, () => {
                            if (comboTimer) clearTimeout(comboTimer);
                            const now = Date.now();
                            if (now - lastMatchTime <= COMBO_TIME_LIMIT) {
                                comboCount++;
                            } else {
                                comboCount = 1;
                            }
                            lastMatchTime = now;
                            const basePoints = 10;
                            const comboBonus = comboCount > 1 ? (comboCount - 1) * COMBO_SCORE_MULTIPLIER : 0;
                            score += basePoints + comboBonus;

                            const num1 = gameBoard[firstCellIndex].value;
                            const num2 = gameBoard[secondCellIndex].value;
                            trackEvent('match_made', {
                                level_number: stage,
                                numbers: `${num1},${num2}`,
                                match_type: num1 === num2 ? 'same_number' : 'sum_to_10',
                                combo_count: comboCount
                            });

                            if (comboCount > 1) {
                                playSound('combo');
                            } else {
                                playSound('normal');
                            }

                            const wasHintedPair = hintedPair &&
                                ((hintedPair[0] === firstCellIndex && hintedPair[1] === secondCellIndex) ||
                                 (hintedPair[0] === secondCellIndex && hintedPair[1] === firstCellIndex));

                            if (wasHintedPair && hintCount === 0 && stage >= 2) {
                                startHintReplenishCooldown();
                            }

                            comboTimer = setTimeout(resetCombo, COMBO_TIME_LIMIT);
                            gameBoard[firstCellIndex].state = 'blurred';
                            gameBoard[secondCellIndex].state = 'blurred';
                            selectedGameCellIndex = null;
                            hintedPair = null; 
                            setTimeout(() => {
                                compactGameBoard();
                                renderMainGameBoard();
                                addCellClickListeners();
                                checkEndGameStatus();
                            }, 200);
                        }, matchResult.type);
                    } else {
                        playSound('error');
                        showIncorrectPairEffect(selectedGameCellIndex, index, matchResult.blocking);
                        
                        const num1 = gameBoard[selectedGameCellIndex].value;
                        const num2 = gameBoard[index].value;
                        const reason = matchResult.blocking.length > 0 ? 'blocked' : 'invalid_pair';
                        trackEvent('match_failed', {
                            level_number: stage,
                            numbers: `${num1},${num2}`,
                            reason: reason
                        });

                        resetCombo();

                        const cell1 = mainGameGrid.children[selectedGameCellIndex];
                        if (cell1) {
                            setTimeout(() => {
                                cell1.classList.remove('selected');
                            }, 100);
                        }
                        selectedGameCellIndex = null;

                        if (hintedPair) {
                            if (mainGameGrid.children[hintedPair[0]]) mainGameGrid.children[hintedPair[0]].classList.remove('hint-highlight');
                            if (mainGameGrid.children[hintedPair[1]]) mainGameGrid.children[hintedPair[1]].classList.remove('hint-highlight');
                            hintedPair = null;
                        }
                    }
                }
            }

            function playMatchAnimation(gridElement, index1, index2, callback, matchType) {
                const cell1 = gridElement.children[index1];
                const cell2 = gridElement.children[index2];
                if (!cell1 || !cell2) {
                    callback();
                    return;
                }
                const appRect = appWrapper.getBoundingClientRect();
                const rect1 = cell1.getBoundingClientRect();
                const rect2 = cell2.getBoundingClientRect();
                const svgOverlay = document.getElementById('line-svg-overlay');

                if (matchType === 'sequential') {
                    const gridRect = gridElement.getBoundingClientRect();
                    const firstIndex = Math.min(index1, index2);
                    const secondIndex = Math.max(index1, index2);
                    const firstCell = gridElement.children[firstIndex];
                    const secondCell = gridElement.children[secondIndex];
                    const rect1_ordered = firstCell.getBoundingClientRect();
                    const rect2_ordered = secondCell.getBoundingClientRect();

                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line1.setAttribute('x1', rect1_ordered.left - appRect.left + rect1_ordered.width / 2);
                    line1.setAttribute('y1', rect1_ordered.top - appRect.top + rect1_ordered.height / 2);
                    line1.setAttribute('x2', gridRect.right - appRect.left);
                    line1.setAttribute('y2', rect1_ordered.top - appRect.top + rect1_ordered.height / 2);
                    line1.setAttribute('stroke', '#3b82f6');
                    line1.setAttribute('stroke-width', '3');
                    svgOverlay.appendChild(line1);

                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line2.setAttribute('x1', gridRect.left - appRect.left);
                    line2.setAttribute('y1', rect2_ordered.top - appRect.top + rect2_ordered.height / 2);
                    line2.setAttribute('x2', rect2_ordered.left - appRect.left + rect2_ordered.width / 2);
                    line2.setAttribute('y2', rect2_ordered.top - appRect.top + rect2_ordered.height / 2);
                    line2.setAttribute('stroke', '#3b82f6');
                    line2.setAttribute('stroke-width', '3');
                    svgOverlay.appendChild(line2);
                } else {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', rect1.left - appRect.left + rect1.width / 2);
                    line.setAttribute('y1', rect1.top - appRect.top + rect1.height / 2);
                    line.setAttribute('x2', rect2.left - appRect.left + rect2.width / 2);
                    line.setAttribute('y2', rect2.top - appRect.top + rect2.height / 2);
                    line.setAttribute('stroke', '#3b82f6');
                    line.setAttribute('stroke-width', '3');
                    svgOverlay.appendChild(line);
                }

                const midX = ((rect1.left + rect1.right) / 2 + (rect2.left + rect2.right) / 2) / 2 - appRect.left;
                const midY = ((rect1.top + rect1.bottom) / 2 + (rect2.top + rect2.bottom) / 2) / 2 - appRect.top;
                const effectCtx = effectCanvas.getContext('2d');
                for (let i = 0; i < 30; i++) {
                    confettiParticles.push(new ConfettiParticle(midX, midY, effectCtx));
                }
                if (!animationFrameId) {
                    animateConfetti();
                }

                setTimeout(() => {
                    svgOverlay.innerHTML = '';
                    callback();
                }, 400); 
            }
            
            function compactGameBoard() {
                const newBoard = [];
                for (let i = 0; i < gameBoard.length; i += GAME_COLS) {
                    const row = gameBoard.slice(i, i + GAME_COLS);
                    if (!row.every(cell => cell.state === 'blurred' || cell.state === 'cleared')) {
                        newBoard.push(...row);
                    }
                }
                while(newBoard.length < gameBoard.length) {
                    newBoard.push({ value: null, state: 'cleared' });
                }
                gameBoard = newBoard;
            }

            function hasAvailableMoves() {
                return findValidPair(gameBoard, GAME_COLS) !== null;
            }

             function startNextStageTransition(newStage, isFromTutorial = false) {
                 isStageCompleting = true;
                 trackEvent('level_complete', { level_number: stage });
                 const winMsgKey = isFromTutorial ? 'win_tutorial_complete' : 'win_stage_cleared';
                 const congratsMessages = ["Awesome!", "Great Job!", "Fantastic!", "Well Done!"];
                 const randomCongrats = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
                 winMessage.innerHTML = `${randomCongrats}<br><span class="text-2xl">${translations[currentLang][winMsgKey] || translations['en'][winMsgKey]}</span>`;
                 nextStageDataForCallback = { newStage, isFromTutorial };
                 winAnimation.classList.remove('hidden');
                 winCanvas.width = appWrapper.clientWidth;
                 winCanvas.height = appWrapper.clientHeight;
                 winConfettiParticles.length = 0;
                 if(!winAnimationId) animateWinConfetti();
                 playSound('win');
                 setTimeout(proceedToNextStage, 1000);
             }

            function checkEndGameStatus() {
                if (isStageCompleting) return;
                
                clearAllBlurbTimers();

                const isGridEmpty = gameBoard.every(c => c.state !== 'active');
                if (isGridEmpty) {
                    startNextStageTransition(stage + 1);
                    return;
                }
                const noMovesLeft = !hasAvailableMoves();
                if (noMovesLeft) {
                    if (addRowCount > 0) {
                        addRowBtn.disabled = false;
                        addRowBlurb.classList.remove('hidden');
                        pointHandToButton(addRowBtn, 'bottom', '👆');
                    } else {
                        gameOverModal.classList.remove('hidden');
                        trackEvent('level_failed', { level_number: stage });
                    }
                } else {
                    addRowBtn.disabled = true;
                    addRowBlurb.classList.add('hidden');
                    
                    const validPairs = findAllValidPairs(gameBoard, GAME_COLS);
                    const matchesLeft = validPairs.length;
                    
                    if (matchesLeft === 2 && stage > 2 && !hasShownLowMatchesToast) {
                        hasShownLowMatchesToast = true;
                        showLowMatchesToast(matchesLeft);
                    } else {
                        startInactiveTimers();
                    }
                }
            }

            function updateScore() {
                currentScoreEl.textContent = score;
                if (score > bestScore) {
                    bestScore = score;
                    bestScoreEl.textContent = bestScore;
                    homeBestScoreValue.textContent = bestScore;
                    localStorage.setItem('sumLinkBestScore', bestScore);
                }
            }

            function resetCombo() {
                comboCount = 0;
                lastMatchTime = 0;
                if (comboTimer) clearTimeout(comboTimer);
            }

            function showComboIndicator(count) {}

            function clearAllBlurbTimers() {
                clearTimeout(inactiveTimer);
                blurbCycleTimers.forEach(timerId => clearTimeout(timerId));
                blurbCycleTimers = [];
                hintBlurb.classList.add('hidden');
                slideInToast.style.left = '-110%';

                hideHandIcon();
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                }
            }
            
            function startInactiveTimers() {
                clearAllBlurbTimers();
                inactiveTimer = setTimeout(showHintBlurb, 15000);
            }

            function showHintBlurb() {
                if (gameContainer.classList.contains('hidden') || !pauseModal.classList.contains('hidden')) {
                    return;
                }
                if (stage <= 4 && hasAvailableMoves() && hintCount > 0) {
                    hintBlurb.classList.remove('hidden');
                    pointHandToButton(hintBtn, 'bottom', '👆');
                    playHintSound();
                }
            }

            function showLowMatchesToast(matchesLeft) {
                clearAllBlurbTimers();
                const toastTemplate = translations[currentLang].unlock_toast_message || translations.en.unlock_toast_message;
                const message = toastTemplate.replace('{}', matchesLeft);

                const showToast = () => {
                    slideInToast.textContent = message;
                    slideInToast.style.left = '5%';
                    playLowMatchesSound();
                };

                const hideToast = () => {
                    slideInToast.style.left = '-110%';
                    startInactiveTimers(); 
                };

                showToast();

                const timer = setTimeout(hideToast, 5000);
                blurbCycleTimers.push(timer);
            }

            langSelectBtn.onclick = (e) => {
                e.stopPropagation();
                gameLangDropdownContent.classList.remove('show');
                langDropdownContent.classList.toggle('show');
            };

            gameLangSelectBtn.onclick = (e) => {
                e.stopPropagation();
                langDropdownContent.classList.remove('show');
                gameLangDropdownContent.classList.toggle('show');
            };

            document.querySelectorAll('.lang-option').forEach(option => {
                option.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const langCode = e.target.dataset.langCode;
                    setLanguage(langCode);
                    trackEvent('language_selected', { language_code: langCode });
                    const dropdown = e.target.closest('.lang-dropdown-content');
                    if(dropdown) {
                        dropdown.classList.remove('show');
                    }
                }
            });

            document.querySelectorAll('.initial-lang-btn').forEach(btn => {
                btn.onclick = (e) => {
                    initAudio();
                    playSound('click');
                    const lang = e.target.dataset.langCode;
                    setLanguage(lang);
                    trackEvent('language_selected', { language_code: lang });
                    languageSelectionScreen.classList.add('hidden');
                    showNextScreen(); // Directly proceed to the game.
                }
            });

            hintBtn.onclick = () => {
                playSound('click');
                if (isHintSingleUseCooldown || hintCount <= 0) return;
                clearAllBlurbTimers();
                startInactiveTimers();
                if (!hasAvailableMoves()) {
                    checkEndGameStatus();
                    return;
                }

                trackEvent('game_action', { level_number: stage, action_type: 'hint' });
                hintCount--;
                hintBadge.textContent = hintCount;
                const pair = findValidPair(gameBoard, GAME_COLS);
                if(pair) {
                    const [idx1, idx2] = pair;
                    const cell1 = mainGameGrid.children[idx1];
                    const cell2 = mainGameGrid.children[idx2];
                    cell1.classList.add('hint-highlight');
                    cell2.classList.add('hint-highlight');
                    hintedPair = pair;
                }
                if (hintCount <= 0) {
                    hintBtn.disabled = true;
                    hintBlurb.classList.add('hidden');
                    hideHandIcon();
                } else {
                    isHintSingleUseCooldown = true;
                    hintBtn.disabled = true;
                    setTimeout(() => {
                        isHintSingleUseCooldown = false;
                        if (hintCount > 0) {
                           hintBtn.disabled = false;
                        }
                    }, HINT_SINGLE_USE_COOLDOWN_SECONDS * 1000);
                }
            };
            
            whatsappShareBtn.onclick = () => {
                playSound('click');
                const scoreValue = bestScore;
                const message = `Here's my top score ${scoreValue} for mind boggling game, you could improve analytical & mathematical skills using this game. Can you beat me? Only nominal IQ persons can solve Number Match Game`;
                const gameUrl = window.location.href;
                const fullMessage = `${message}\n\nPlay here: ${gameUrl}`;
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(fullMessage)}`;
                window.open(whatsappUrl, '_blank');
                trackEvent('share_clicked', { platform: 'whatsapp' });
            };

            addRowBtn.onclick = () => {
                playSound('click');
                hideHandIcon();
                if (addRowBtn.disabled) return;
                
                clearAllBlurbTimers();

                trackEvent('game_action', { level_number: stage, action_type: 'add_row' });
                addRowBtn.disabled = true;
                addRowBlurb.classList.add('hidden');

                const remainingActiveValues = gameBoard.filter(c => c.state === 'active').map(c => c.value);
                
                let lastPopulatedIndex = -1;
                for (let i = gameBoard.length - 1; i >= 0; i--) {
                    if (gameBoard[i].state !== 'cleared') {
                        lastPopulatedIndex = i;
                        break;
                    }
                }

                let currentIndex = lastPopulatedIndex + 1;
                for(let i = 0; i < remainingActiveValues.length; i++) {
                    if(currentIndex < gameBoard.length) {
                        gameBoard[currentIndex] = { value: remainingActiveValues[i], state: 'active' };
                        currentIndex++;
                    }
                }

                addRowCount--;
                addRowBadge.textContent = addRowCount;
                renderMainGameBoard();
                addCellClickListeners();
                resetCombo();
                checkEndGameStatus();
            };

            function startHintReplenishCooldown() {
                if (hintReplenishCooldownInterval) return;

                hintBtn.disabled = true;
                hintBadge.style.display = 'none';
                let countdown = HINT_REPLENISH_SECONDS;

                hintBtn.style.backgroundImage = `url('https://i.postimg.cc/sgy79DcS/106-1066840-clock-no-hands-png-transparent-clock-no-hands-removebg-preview.png')`;
                hintBtn.style.backgroundSize = 'contain';
                hintBtn.style.backgroundRepeat = 'no-repeat';
                hintBtn.style.backgroundPosition = 'center';
                hintBtn.style.backgroundColor = '#87CEEB'; // Sky blue
                hintBtn.innerHTML = `<span class="text-3xl font-bold text-gray-800 no-pointer">${countdown}</span>`;

                hintReplenishCooldownInterval = setInterval(() => {
                    countdown--;
                    hintBtn.innerHTML = `<span class="text-3xl font-bold text-gray-800 no-pointer">${countdown}</span>`;
                    if (countdown <= 0) {
                        clearInterval(hintReplenishCooldownInterval);
                        hintReplenishCooldownInterval = null;
                        
                        hintBtn.style.backgroundImage = '';
                        hintBtn.style.backgroundColor = '';
                        hintCount = 3;
                        hintBadge.textContent = hintCount;
                        hintBtn.innerHTML = '💡';
                        hintBtn.style.fontSize = '2.5rem';
                        hintBadge.style.display = 'flex';
                        hintBtn.disabled = false;
                        playSound('win');
                    }
                }, 1000);
            }

            pauseBtn.onclick = () => {
                playSound('click');
                pauseModal.classList.remove('hidden');
                clearAllBlurbTimers();
                trackEvent('game_paused', { level_number: stage });

                // Hide the objective toast when pausing the game
                const objectiveToast = document.getElementById('unlock-toast');
                if (!objectiveToast.classList.contains('hidden')) {
                    clearTimeout(objectiveToast.dataset.timeoutId);
                    objectiveToast.classList.add('hidden');
                    objectiveToast.style.opacity = 0;
                }
            };
            closePauseModalBtn.onclick = () => { playSound('click'); pauseModal.classList.add('hidden'); startInactiveTimers(); };
            continueBtn.onclick = () => { playSound('click'); pauseModal.classList.add('hidden'); startInactiveTimers(); };
            retryBtn.onclick = () => {
                playSound('click');
                pauseModal.classList.add('hidden');
                trackEvent('level_retry', { level_number: stage });
                initGame(stage);
            };
            soundToggleBtn.onclick = () => {
                soundEnabled = !soundEnabled;
                soundToggleBtn.textContent = soundEnabled ? '🔊' : '🔇';
                trackEvent('settings_action', { action: 'sound_toggle', enabled: soundEnabled });
                playSound('click');
            };
            howToPlayBtn.onclick = () => {
                playSound('click');
                pauseModal.classList.add('hidden');
                clearAllBlurbTimers();
                tutorialContainer.classList.remove('hidden');
                gameContainer.classList.add('hidden');
                initTutorial(true);
            };
            homeSettingsBtn.onclick = () => {
                initAudio();
                playSound('click');
                trackEvent('settings_opened');
                settingsModal.classList.remove('hidden'); 
            };
            closeSettingsModalBtn.onclick = () => { playSound('click'); settingsModal.classList.add('hidden'); };

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const langCode = e.target.dataset.langCode;
                    setLanguage(langCode);
                    trackEvent('language_selected', { language_code: langCode });
                }
            });
            backBtn.onclick = () => {
                playSound('click');
                clearAllBlurbTimers();
                trackEvent('navigation_to_home');

                // Save the game state before navigating away from the game screen
                if (!isStageCompleting) {
                    const gameState = {
                        board: gameBoard,
                        score: score,
                        stage: stage,
                        addRowCount: addRowCount,
                        hintCount: hintCount
                    };
                    localStorage.setItem('sumLinkGameState', JSON.stringify(gameState));
                }

                gameContainer.classList.add('hidden');
                homeScreen.classList.remove('hidden');
                continueGameBtn.disabled = false;
                resetCombo();
            };
            newGameBtn.onclick = () => {
                initAudio();
                playSound('click');
                // Show the confirmation modal instead of starting the game directly
                const savedState = localStorage.getItem('sumLinkGameState');
                if (savedState) {
                    document.getElementById('new-game-confirm-modal').classList.remove('hidden');
                    trackEvent('new_game_prompt_shown');
                } else {
                    // If there's no saved game, just start a new one
                    trackEvent('game_start', { type: 'new_game' });
                    homeScreen.classList.add('hidden');
                    gameContainer.classList.remove('hidden');
                    initGame(1);
                }
            };
            continueGameBtn.onclick = () => {
                initAudio();
                playSound('click');
                trackEvent('game_start', { type: 'continue_game' });
                homeScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
            };
            feedbackBtn.onclick = () => {
                trackEvent('cta_clicked', { button_name: 'feedback' });
                feedbackModal.classList.remove('hidden');
            };
            closeFeedbackModalBtn.onclick = () => feedbackModal.classList.add('hidden');
            cancelFeedbackBtn.onclick = () => feedbackModal.classList.add('hidden');
            
            const restartCurrentLevel = () => {
                playSound('click');
                gameOverModal.classList.add('hidden');
                trackEvent('game_over_action', { action: 'try_again', level_number: stage });
                initGame(stage);
            };
            tryAgainBtn.onclick = restartCurrentLevel;
            closeGameOverModalBtn.onclick = restartCurrentLevel;
            
            gameOverHomeBtn.onclick = () => {
                playSound('click');
                clearAllBlurbTimers();
                trackEvent('game_over_action', { action: 'go_home', level_number: stage });
                localStorage.removeItem('sumLinkGameState'); // Clear the failed game state
                gameOverModal.classList.add('hidden');
                gameContainer.classList.add('hidden');
                homeScreen.classList.remove('hidden');
                continueGameBtn.disabled = true; // No game to continue, so disable
                resetCombo();
            };
            
            document.getElementById('new-game-confirm-yes-btn').onclick = () => {
                playSound('click');
                document.getElementById('new-game-confirm-modal').classList.add('hidden');
                trackEvent('game_start', { type: 'new_game_confirmed' });
                localStorage.removeItem('sumLinkGameState'); // Clear any old state
                homeScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                initGame(1);
            };

            document.getElementById('new-game-confirm-no-btn').onclick = () => {
                playSound('click');
                document.getElementById('new-game-confirm-modal').classList.add('hidden');
                trackEvent('new_game_prompt_response', { choice: 'no' });
            };

            feedbackForm.onsubmit = async (e) => {
                e.preventDefault();
                trackEvent('form_submitted', { form_type: 'feedback' });
                const submitButton = e.target.querySelector('button[type="submit"]');
                const ratingInput = feedbackForm.querySelector('input[name="rating"]:checked');
                const reviewInput = document.getElementById('review-message');
                const feedbackError = document.getElementById('feedback-error');
                feedbackError.classList.add('hidden');

                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';

                const AIRTABLE_TOKEN = 'patte6OcWdeqT1ERE.c02f929a1abe3b2bf64300596d4af91a723fe8c38012105c211f470d3ee70d4c';
                const BASE_ID = 'appmpHVpkjNxozFo9';
                const TABLE_NAME = 'Feedback Submissions';
                const ratingValue = ratingInput ? parseInt(ratingInput.value) : null;
                const reviewText = reviewInput.value;

                const data = {
                    "fields": {
                        "Ratings": ratingValue,
                        "Reviews": reviewText
                    }
                };

                try {
                    const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(`Airtable Error: ${error.error.message}`);
                    }
                    console.log("Feedback sent to Airtable successfully!");
                } catch (error) {
                    console.error("Failed to send feedback to Airtable:", error);
                    feedbackError.textContent = 'Sorry, something went wrong. Please try again.';
                    feedbackError.classList.remove('hidden');
                } finally {
                    if (feedbackError.classList.contains('hidden')) {
                        feedbackModal.classList.add('hidden');
                        thankYouModal.classList.remove('hidden');
                        thankYouThumb.classList.add('animated-thumb');
                        thankYouThumb.addEventListener('animationend', () => {
                            thankYouThumb.classList.remove('animated-thumb');
                        }, { once: true });
                        setTimeout(() => {
                            thankYouModal.classList.add('hidden');
                        }, 3000);
                    }
                    submitButton.disabled = false;
                    const originalSubmitText = translations[currentLang].submit || translations['en'].submit;
                    submitButton.textContent = originalSubmitText;
                    feedbackForm.reset();
                }
            };

            function showNextScreen() {
                bestScore = localStorage.getItem('sumLinkBestScore') || 0;
                homeBestScoreValue.textContent = bestScore;
                const tutorialCompleted = localStorage.getItem('sumLinkTutorialCompleted');
                
                if (!tutorialCompleted) {
                    tutorialContainer.classList.remove('hidden');
                    initTutorial();
                } else {
                    homeScreen.classList.remove('hidden');
                    const savedStateJSON = localStorage.getItem('sumLinkGameState');
                    if (savedStateJSON) {
                        try {
                            const savedState = JSON.parse(savedStateJSON);
                            gameBoard = savedState.board;
                            score = savedState.score;
                            stage = savedState.stage;
                            addRowCount = savedState.addRowCount;
                            hintCount = savedState.hintCount !== undefined ? savedState.hintCount : 3;
                            renderMainGameBoard();
                            addCellClickListeners();
                            stageTitle.textContent = `Stage ${stage}`;
                            addRowBadge.textContent = addRowCount;
                            hintBadge.textContent = hintCount;
                            bestScoreEl.textContent = bestScore;
                            continueGameBtn.disabled = false;
                            checkEndGameStatus();
                            if (hintCount <= 0 && stage >= 2) {
                                startHintReplenishCooldown();
                            } else {
                                hintBtn.disabled = hintCount <= 0;
                            }
                        } catch (e) {
                             console.error("Failed to parse saved game state:", e);
                             localStorage.removeItem('sumLinkGameState');
                             continueGameBtn.disabled = true;
                        }
                    } else {
                        continueGameBtn.disabled = true;
                    }
                }
            }

            function initialLoad() {
                let userId = localStorage.getItem('sumLinkUserId');
                if (!userId) {
                    userId = crypto.randomUUID();
                    localStorage.setItem('sumLinkUserId', userId);
                }
                trackEvent('session_start', { user_id: userId });

                const urlParams = new URLSearchParams(window.location.search);
                const urlLang = urlParams.get('lang');
                const savedLang = localStorage.getItem('sumLinkLanguage');
                
                let determinedLang = null;

                if (urlLang && translations[urlLang.toLowerCase()]) {
                    determinedLang = urlLang.toLowerCase();
                } else if (savedLang) {
                    determinedLang = savedLang;
                }

                if (determinedLang) {
                    setLanguage(determinedLang);
                    languageSelectionScreen.classList.add('hidden');
                    showNextScreen();
                } else {
                    languageSelectionScreen.classList.remove('hidden');
                }
            }
            
            window.onbeforeunload = () => {
                if (!gameContainer.classList.contains('hidden')) {
                    const gameState = {
                        board: gameBoard,
                        score: score,
                        stage: stage,
                        addRowCount: addRowCount,
                        hintCount: hintCount
                    };
                    localStorage.setItem('sumLinkGameState', JSON.stringify(gameState));
                }
            };
            
            window.onclick = function() {
                langDropdownContent.classList.remove('show');
                gameLangDropdownContent.classList.remove('show');
            }
            
            initialLoad();
        });
    </script>



























</body></html>